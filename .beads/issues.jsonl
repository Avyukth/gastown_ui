{"id":"hq-0er","title":"[P1] API Routes: Gas Town Endpoints","description":"# Phase 1 API Routes Layer\n\n## Background\nAll API routes live under /api/gastown/* and serve as the bridge between\nthe SvelteKit frontend and the Gas Town CLI tools (gt, bd).\n\n## Endpoints to Implement (from INTEGRATION_PLAN v5.0)\n\n### Core Endpoints\n- GET /api/gastown/status - System status (gt status --json)\n- GET /api/gastown/agents - Agent list (parsed from gt status)\n- GET /api/gastown/convoys - Convoy list (gt convoy list --json)\n- GET /api/gastown/mail - Mail messages (bd list --type=message, NOT gt mail inbox)\n- GET /api/gastown/queue - Merge queue (gt mq list --json)\n- GET /api/gastown/rigs - Rig list (gt rig list --json)\n- GET /api/gastown/work - Work items (bd list --json)\n\n### System Endpoints\n- GET /api/gastown/capabilities - CLI version and feature flags\n- GET /api/gastown/diagnostics - Health checks (gt doctor --json)\n- GET /api/gastown/feed/stream - SSE activity stream\n\n## Why This Matters\n- Routes are the contract between frontend and backend\n- Each route wraps CLI execution with proper error handling\n- All routes must handle: timeouts, JSON parse failures, CLI errors\n- SSE stream enables real-time updates without polling\n\n## Acceptance Criteria\n- [ ] All core endpoints return valid JSON\n- [ ] Error responses follow consistent schema with requestId\n- [ ] Timeouts configured per endpoint\n- [ ] Known bugs have workarounds (gt mail inbox → bd list)\n- [ ] SSE stream broadcasts events from .events.jsonl\n- [ ] All routes use Process Supervisor (no direct spawn)\n\n## Architecture Decision References\n- D1.1: Endpoint Structure\n- D1.4: Feed Endpoint Structure\n- D2.3: SSE vs WebSocket for Updates\n\n## Dependencies\n- EPIC: Foundation Layer (hq-0qb)\n- EPIC: Data Layer (hq-bpb)\n\n## Files to Create/Modify\n- src/routes/api/gastown/status/+server.ts\n- src/routes/api/gastown/agents/+server.ts\n- src/routes/api/gastown/convoys/+server.ts\n- src/routes/api/gastown/mail/+server.ts\n- src/routes/api/gastown/queue/+server.ts\n- src/routes/api/gastown/rigs/+server.ts\n- src/routes/api/gastown/work/+server.ts\n- src/routes/api/gastown/capabilities/+server.ts\n- src/routes/api/gastown/diagnostics/+server.ts\n- src/routes/api/gastown/feed/stream/+server.ts","status":"open","priority":1,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:08:15.008388+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:08:15.008388+05:30","labels":["critical:yes","layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er","depends_on_id":"hq-0qb","type":"blocks","created_at":"2026-01-12T22:08:15.010063+05:30","created_by":"Avyukth"},{"issue_id":"hq-0er","depends_on_id":"hq-bpb","type":"blocks","created_at":"2026-01-12T22:08:15.010954+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.1","title":"Implement /api/gastown/status endpoint","description":"# Status Endpoint Implementation\n\n## Background\nThe status endpoint returns system overview including workspace info, agent status,\nand rig list. This is the primary \"health check\" endpoint.\n\n## CLI Command\n```bash\ngt status --json\n```\n\n## Expected Response\n```json\n{\n  \"workspace\": \"/path/to/workspace\",\n  \"agents\": [\n    {\n      \"name\": \"mayor\",\n      \"type\": \"mayor\",\n      \"status\": \"running\",\n      \"rig\": null\n    },\n    {\n      \"name\": \"gastown_ui/witness\",\n      \"type\": \"witness\",\n      \"status\": \"idle\",\n      \"rig\": \"gastown_ui\"\n    }\n  ],\n  \"rigs\": [\n    {\n      \"name\": \"gastown_ui\",\n      \"path\": \"/path/to/rig\"\n    }\n  ],\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Implementation\n```typescript\n// src/routes/api/gastown/status/+server.ts\n\nimport { json } from '@sveltejs/kit';\nimport { processSupervisor } from '$lib/server/cli/process-supervisor';\nimport { StatusContract } from '$lib/server/cli/contracts';\nimport { swrCache } from '$lib/server/cache/swr';\n\nexport async function GET({ request }) {\n  const requestId = request.headers.get('x-request-id') || crypto.randomUUID();\n  \n  try {\n    const data = await swrCache.get('status', async () =\u003e {\n      const result = await processSupervisor.run('gt', ['status', '--json'], {\n        timeout: 10000,\n        requestId\n      });\n      return JSON.parse(result.stdout);\n    }, { staleTime: 5000 });\n    \n    const validated = StatusContract.parse(data);\n    return json(validated);\n  } catch (error) {\n    return json(error.toJSON(), { status: 500 });\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Returns system status JSON\n- [ ] Uses SWR cache with 5s stale time\n- [ ] Validates response with Zod contract\n- [ ] Handles CLI errors gracefully\n- [ ] Includes requestId in error responses\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/status/+server.ts\n- src/routes/api/gastown/status/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Status Endpoint section\n- CLI: gt status --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:12:08.564913+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:12:08.564913+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.1","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:12:08.565595+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.10","title":"Implement /api/gastown/capabilities endpoint","description":"# Capabilities Endpoint Implementation\n\n## Background\nReturns CLI capabilities and version information. Used by frontend to enable/\ndisable features based on what the CLI supports.\n\n## Response\n```json\n{\n  \"gt_version\": \"1.2.3\",\n  \"bd_version\": \"1.0.0\",\n  \"features\": {\n    \"json_output\": true,\n    \"mail_inbox\": false,\n    \"sse_tailing\": true,\n    \"convoys\": true,\n    \"formulas\": true\n  },\n  \"paths\": {\n    \"workspace\": \"/path/to/workspace\",\n    \"beads_db\": \"/path/to/.beads\",\n    \"events_file\": \"/path/to/.beads/.events.jsonl\"\n  },\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Implementation\nWraps the Capabilities Probe service (hq-0qb.3).\n\n## Acceptance Criteria\n- [ ] Returns capabilities JSON\n- [ ] Cached for 1 hour (rarely changes)\n- [ ] Feature flags reflect actual CLI capabilities\n- [ ] Paths auto-discovered\n- [ ] Unit test with mocked probe\n\n## Files\n- src/routes/api/gastown/capabilities/+server.ts\n\n## References\n- INTEGRATION_PLAN D0.6: Capabilities Probe\n- Depends on: hq-0qb.3 (Capabilities Probe)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":30,"created_at":"2026-01-12T22:28:32.908116+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:28:32.908116+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.10","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:28:32.908832+05:30","created_by":"Avyukth"},{"issue_id":"hq-0er.10","depends_on_id":"hq-0qb.3","type":"blocks","created_at":"2026-01-12T22:28:32.910198+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.2","title":"Implement /api/gastown/work endpoint","description":"# Work Endpoint Implementation\n\n## Background\nThe work endpoint returns all work items (tasks, bugs, epics, etc.) from the\nbeads database. This is one of the most frequently called endpoints.\n\n## CLI Command\n```bash\nbd list --json\n```\n\n## Expected Response\n```json\n{\n  \"items\": [\n    {\n      \"id\": \"bd-123\",\n      \"title\": \"Implement feature X\",\n      \"status\": \"open\",\n      \"priority\": 2,\n      \"issue_type\": \"task\",\n      \"assignee\": \"avyukth\",\n      \"labels\": [\"phase:1\"],\n      \"created_at\": \"2026-01-12T10:00:00Z\",\n      \"updated_at\": \"2026-01-12T10:00:00Z\"\n    }\n  ],\n  \"total\": 42,\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Query Parameters\n- `type`: Filter by issue type (task, bug, epic, etc.)\n- `status`: Filter by status (open, closed, in_progress)\n- `priority`: Filter by priority (0-4)\n- `assignee`: Filter by assignee\n- `labels`: Filter by labels (comma-separated)\n\n## Implementation\n```typescript\n// src/routes/api/gastown/work/+server.ts\n\nimport { json } from '@sveltejs/kit';\nimport { processSupervisor } from '$lib/server/cli/process-supervisor';\nimport { WorkItemContract } from '$lib/server/cli/contracts';\nimport { z } from 'zod';\n\nexport async function GET({ url, request }) {\n  const requestId = request.headers.get('x-request-id') || crypto.randomUUID();\n  \n  // Build CLI args from query params\n  const args = ['list', '--json'];\n  const type = url.searchParams.get('type');\n  if (type) args.push('--type', type);\n  const status = url.searchParams.get('status');\n  if (status) args.push('--status', status);\n  // ... more filters\n  \n  try {\n    const data = await swrCache.get(\n      `work:${url.search}`,\n      async () =\u003e {\n        const result = await processSupervisor.run('bd', args, {\n          timeout: 15000,\n          requestId\n        });\n        return JSON.parse(result.stdout);\n      },\n      { staleTime: 10000 }\n    );\n    \n    const items = z.array(WorkItemContract).parse(data);\n    return json({ items, total: items.length });\n  } catch (error) {\n    return json(error.toJSON(), { status: 500 });\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Returns work items JSON\n- [ ] Supports filtering by type, status, priority, assignee, labels\n- [ ] Uses SWR cache with 10s stale time\n- [ ] Validates response with Zod contract\n- [ ] Handles empty results gracefully\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/work/+server.ts\n- src/routes/api/gastown/work/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Work Endpoint section\n- CLI: bd list --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:12:08.834082+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:12:08.834082+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.2","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:12:08.834656+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.3","title":"Implement /api/gastown/convoys endpoint","description":"# Convoys Endpoint Implementation\n\n## Background\nReturns convoy list with their contained work items. Convoys are batched work\ngroups used for tracking related tasks.\n\n## CLI Command\n```bash\ngt convoy list --json\n```\n\n## Expected Response\n```json\n{\n  \"convoys\": [\n    {\n      \"id\": \"convoy-abc\",\n      \"title\": \"Phase 1 Implementation\",\n      \"status\": \"active\",\n      \"items\": [\"bd-123\", \"bd-124\", \"bd-125\"],\n      \"progress\": 33,\n      \"created_at\": \"2026-01-12T10:00:00Z\"\n    }\n  ],\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Implementation Notes\n- Convoy progress calculated from contained items\n- Items array contains bead IDs, not full objects\n- Use /api/gastown/convoys/[id] for full convoy details\n\n## Acceptance Criteria\n- [ ] Returns convoy list JSON\n- [ ] Progress calculated from item statuses\n- [ ] Uses SWR cache with 30s stale time\n- [ ] Validates response with Zod contract\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/convoys/+server.ts\n- src/routes/api/gastown/convoys/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Convoys Endpoint section\n- CLI: gt convoy list --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:12:30.904199+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:12:30.904199+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.3","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:12:30.9049+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.4","title":"Implement /api/gastown/mail endpoint (with gt mail inbox workaround)","description":"# Mail Endpoint Implementation\n\n## Background\nReturns mail messages. IMPORTANT: gt mail inbox hangs in Node.js due to a known\nbug. Use bd list --type=message as workaround.\n\n## Known Bug (Critical)\n```\ngt mail inbox --json  ← HANGS in Node.js environment\nbd list --type=message --json  ← WORKAROUND (use this)\n```\n\nThe gt mail inbox command hangs when run from Node.js child_process. This is a\nknown issue documented in INTEGRATION_PLAN. Always use bd list as the primary\ndata source for mail.\n\n## CLI Command (Workaround)\n```bash\nbd list --type=message --json\n```\n\n## Expected Response\n```json\n{\n  \"messages\": [\n    {\n      \"id\": \"msg-123\",\n      \"from\": \"mayor\",\n      \"to\": \"gastown_ui/witness\",\n      \"subject\": \"Work assigned\",\n      \"body\": \"Please review PR #42\",\n      \"read\": false,\n      \"created_at\": \"2026-01-12T10:00:00Z\"\n    }\n  ],\n  \"unread_count\": 5,\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Implementation\n```typescript\n// src/routes/api/gastown/mail/+server.ts\n\nexport async function GET({ request }) {\n  const requestId = request.headers.get('x-request-id') || crypto.randomUUID();\n  \n  // WORKAROUND: Use bd list instead of gt mail inbox\n  // gt mail inbox hangs in Node.js\n  const result = await processSupervisor.run(\n    'bd',\n    ['list', '--type=message', '--json'],\n    { timeout: 10000, requestId }\n  );\n  \n  // ... parse and return\n}\n```\n\n## Acceptance Criteria\n- [ ] Uses bd list workaround, NOT gt mail inbox\n- [ ] Returns messages JSON\n- [ ] Includes unread count\n- [ ] Uses SWR cache with 5s stale time\n- [ ] Documents the workaround in code comments\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/mail/+server.ts\n- src/routes/api/gastown/mail/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Known Bug - gt mail inbox hangs\n- CLI: bd list --type=message --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:27:48.984647+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:27:48.984647+05:30","labels":["known-bug","layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.4","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:27:48.98537+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.5","title":"Implement /api/gastown/rigs endpoint","description":"# Rigs Endpoint Implementation\n\n## Background\nReturns list of registered rigs (project containers). Each rig has polecats,\ncrew members, and agents.\n\n## CLI Command\n```bash\ngt rig list --json\n```\n\n## Expected Response\n```json\n{\n  \"rigs\": [\n    {\n      \"name\": \"gastown_ui\",\n      \"path\": \"/path/to/gastown_ui\",\n      \"polecats\": 0,\n      \"crew\": 2,\n      \"agents\": [\"refinery\", \"witness\", \"mayor\"]\n    }\n  ],\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Returns rig list JSON\n- [ ] Includes polecat/crew counts\n- [ ] Uses SWR cache with 30s stale time\n- [ ] Validates response with Zod contract\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/rigs/+server.ts\n- src/routes/api/gastown/rigs/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Rigs Endpoint section\n- CLI: gt rig list --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":45,"created_at":"2026-01-12T22:27:49.276099+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:27:49.276099+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.5","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:27:49.276715+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.6","title":"Implement /api/gastown/queue endpoint","description":"# Queue Endpoint Implementation\n\n## Background\nReturns merge queue items. The merge queue shows branches waiting to be merged\nby the Refinery agent.\n\n## CLI Command\n```bash\ngt mq list --json\n```\n\n## Expected Response\n```json\n{\n  \"items\": [\n    {\n      \"id\": \"mq-123\",\n      \"branch\": \"polecat/avyukth-feature\",\n      \"rig\": \"gastown_ui\",\n      \"status\": \"pending\",\n      \"position\": 1,\n      \"created_at\": \"2026-01-12T10:00:00Z\"\n    }\n  ],\n  \"queue_length\": 3,\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Returns queue items JSON\n- [ ] Includes position in queue\n- [ ] Uses SWR cache with 5s stale time\n- [ ] Validates response with Zod contract\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/queue/+server.ts\n- src/routes/api/gastown/queue/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Queue Endpoint section\n- CLI: gt mq list --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":45,"created_at":"2026-01-12T22:28:08.883138+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:28:08.883138+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.6","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:28:08.883797+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.7","title":"Implement /api/gastown/agents endpoint","description":"# Agents Endpoint Implementation\n\n## Background\nReturns agent list with their current status. Agents include Mayor, Witnesses,\nRefineries, and Polecats.\n\n## CLI Command\nParsed from gt status --agents output.\n\n## Expected Response\n```json\n{\n  \"agents\": [\n    {\n      \"name\": \"mayor\",\n      \"type\": \"mayor\",\n      \"status\": \"running\",\n      \"rig\": null,\n      \"last_heartbeat\": \"2026-01-12T10:00:00Z\"\n    },\n    {\n      \"name\": \"gastown_ui/witness\",\n      \"type\": \"witness\",\n      \"status\": \"idle\",\n      \"rig\": \"gastown_ui\",\n      \"last_heartbeat\": \"2026-01-12T09:59:00Z\"\n    }\n  ],\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Acceptance Criteria\n- [ ] Returns agent list JSON\n- [ ] Includes status and last heartbeat\n- [ ] Uses SWR cache with 10s stale time\n- [ ] Validates response with Zod contract\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/agents/+server.ts\n- src/routes/api/gastown/agents/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Agents Endpoint section\n- CLI: gt status --agents","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":45,"created_at":"2026-01-12T22:28:09.160332+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:28:09.160332+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.7","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:28:09.160905+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.8","title":"Implement /api/gastown/diagnostics endpoint","description":"# Diagnostics Endpoint Implementation\n\n## Background\nReturns health check results from gt doctor. Includes checks for workspace\nvalidity, git status, daemon connectivity, etc.\n\n## CLI Command\n```bash\ngt doctor --json\n```\n\n## Expected Response\n```json\n{\n  \"checks\": [\n    {\n      \"name\": \"workspace_valid\",\n      \"status\": \"pass\",\n      \"message\": \"Workspace is valid\"\n    },\n    {\n      \"name\": \"git_status\",\n      \"status\": \"warn\",\n      \"message\": \"Uncommitted changes detected\"\n    },\n    {\n      \"name\": \"daemon_connectivity\",\n      \"status\": \"fail\",\n      \"message\": \"Cannot connect to daemon\"\n    }\n  ],\n  \"overall_status\": \"warn\",\n  \"timestamp\": \"2026-01-12T10:00:00Z\"\n}\n```\n\n## Long-Running Note\ngt doctor can take 10-30 seconds depending on checks. Use longer timeout\nand consider running in background with progress updates.\n\n## Acceptance Criteria\n- [ ] Returns health check results JSON\n- [ ] Longer timeout (30s) for slow checks\n- [ ] Overall status derived from individual checks\n- [ ] Uses SWR cache with 60s stale time\n- [ ] Unit test with mocked CLI\n\n## Files\n- src/routes/api/gastown/diagnostics/+server.ts\n- src/routes/api/gastown/diagnostics/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN: Diagnostics Endpoint section\n- CLI: gt doctor --json","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:28:09.432398+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:28:09.432398+05:30","labels":["layer:api","phase:1"],"dependencies":[{"issue_id":"hq-0er.8","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:28:09.433054+05:30","created_by":"Avyukth"}]}
{"id":"hq-0er.9","title":"Implement /api/gastown/feed/stream SSE endpoint","description":"# SSE Activity Stream Implementation\n\n## Background\nServer-Sent Events (SSE) endpoint for real-time activity updates. The frontend\nsubscribes to this stream to receive push notifications for changes.\n\n## Why SSE over WebSocket?\n- SSE is simpler (one-way communication)\n- Native browser support (EventSource)\n- Automatic reconnection\n- Works through proxies\n- Sufficient for our use case (server → client only)\n\n## Event Types\n```typescript\ntype EventType =\n  | 'work_changed'      // Work item created/updated/deleted\n  | 'convoy_changed'    // Convoy created/updated\n  | 'agent_status'      // Agent started/stopped/idle\n  | 'mail_received'     // New mail message\n  | 'queue_changed'     // Merge queue updated\n  | 'operation_update'  // Long-running operation progress\n  | 'heartbeat';        // Keep-alive (every 30s)\n```\n\n## Implementation\n```typescript\n// src/routes/api/gastown/feed/stream/+server.ts\n\nimport { produce } from 'sveltekit-sse';\n\nexport function GET() {\n  return produce(async function start({ emit }) {\n    // Subscribe to beads watcher events\n    const unsubscribe = beadsWatcher.subscribe((event) =\u003e {\n      emit('message', JSON.stringify({\n        type: event.type,\n        data: event.data,\n        timestamp: Date.now()\n      }));\n    });\n    \n    // Send heartbeat every 30s\n    const heartbeatInterval = setInterval(() =\u003e {\n      emit('message', JSON.stringify({ type: 'heartbeat' }));\n    }, 30000);\n    \n    // Cleanup on disconnect\n    return () =\u003e {\n      unsubscribe();\n      clearInterval(heartbeatInterval);\n    };\n  });\n}\n```\n\n## Client Usage\n```typescript\nconst eventSource = new EventSource('/api/gastown/feed/stream');\n\neventSource.onmessage = (event) =\u003e {\n  const data = JSON.parse(event.data);\n  switch (data.type) {\n    case 'work_changed':\n      workStore.invalidate();\n      break;\n    // ...\n  }\n};\n\neventSource.onerror = () =\u003e {\n  // EventSource auto-reconnects\n  showDegradedBanner();\n};\n```\n\n## Acceptance Criteria\n- [ ] SSE endpoint streams events\n- [ ] Heartbeat every 30s\n- [ ] Auto-reconnection works\n- [ ] Cleanup on disconnect\n- [ ] All event types documented\n- [ ] Integration test verifies stream\n\n## Files\n- src/routes/api/gastown/feed/stream/+server.ts\n- src/lib/stores/sse.ts (client subscription)\n- src/routes/api/gastown/feed/stream/__tests__/server.test.ts\n\n## References\n- INTEGRATION_PLAN D2.3: SSE vs WebSocket for Updates\n- npm: sveltekit-sse","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:28:32.637363+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:28:32.637363+05:30","labels":["layer:api","phase:1","priority:critical"],"dependencies":[{"issue_id":"hq-0er.9","depends_on_id":"hq-0er","type":"parent-child","created_at":"2026-01-12T22:28:32.638054+05:30","created_by":"Avyukth"},{"issue_id":"hq-0er.9","depends_on_id":"hq-bpb.3","type":"blocks","created_at":"2026-01-12T22:28:32.639724+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb","title":"[P1] Foundation Layer: Process Supervisor \u0026 CLI Execution","description":"# Phase 1 Foundation Layer\n\n## Background\nThe foundation layer provides the critical infrastructure for safe, observable CLI execution.\nWithout this layer, the UI cannot reliably communicate with Gas Town.\n\n## Key Innovations (from INTEGRATION_PLAN v5.0)\n1. **Process Supervisor (D0.5)**: No-shell execution with spawn/execFile\n2. **Capabilities Probe (D0.6)**: CLI version detection and feature flags\n3. **Concurrency Limiter (D0.3)**: Prevents resource exhaustion\n\n## Why This Matters\n- CLI commands can hang (known gt mail inbox bug)\n- Without process supervision, hung processes block the entire server\n- Without capability probing, UI breaks when CLI changes\n- Without concurrency limits, rapid requests cause CPU spikes\n\n## Acceptance Criteria\n- [ ] Process Supervisor implemented with spawn/execFile (no shell)\n- [ ] All CLI calls have configurable timeouts\n- [ ] Concurrency limited to configurable max (default 4)\n- [ ] In-flight request deduplication works\n- [ ] Capabilities endpoint returns CLI version and feature flags\n- [ ] Circuit breaker trips on repeated failures\n\n## Architecture Decision References\n- D0.3: CLI Operations Concurrency (Sequential with queue)\n- D0.5: Process Supervisor Pattern\n- D0.6: Capabilities Probe + CLI Contracts\n- D2.4: Effect.ts Error Handling\n\n## Dependencies\nNone - this is the foundation layer\n\n## Files to Create/Modify\n- src/lib/server/cli/process-supervisor.ts\n- src/lib/server/cli/capabilities.ts\n- src/lib/server/cli/concurrency-limiter.ts\n- src/lib/server/cli/contracts.ts\n- src/routes/api/gastown/capabilities/+server.ts","status":"open","priority":1,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:07:07.437468+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:07:07.437468+05:30","labels":["critical:yes","layer:foundation","phase:1"]}
{"id":"hq-0qb.1","title":"Implement Process Supervisor with spawn/execFile","description":"# Process Supervisor Implementation\n\n## Background\nThe Process Supervisor is the core of safe CLI execution. It uses Node's spawn/execFile\ninstead of shell execution, preventing command injection and providing fine-grained\nprocess control.\n\n## Why spawn/execFile instead of exec?\n- exec() uses shell by default → command injection risk\n- execFile() passes args as array → safe, no injection\n- spawn() provides streaming stdout/stderr → real-time logs\n- Both allow process.kill() for cancellation\n\n## Implementation Requirements\n\n### Core API\n```typescript\ninterface ProcessSupervisor {\n  run(command: string, args: string[], options: RunOptions): Promise\u003cRunResult\u003e;\n  cancel(requestId: string): void;\n}\n\ninterface RunOptions {\n  timeout?: number;         // Default 30s\n  cwd?: string;            // Working directory\n  env?: Record\u003cstring,string\u003e;\n  requestId?: string;      // For cancellation\n  onStdout?: (line: string) =\u003e void;\n  onStderr?: (line: string) =\u003e void;\n}\n\ninterface RunResult {\n  stdout: string;\n  stderr: string;\n  exitCode: number;\n  duration: number;\n  requestId: string;\n}\n```\n\n### Error Handling\n- Timeout → throw TimeoutError with partial output\n- Non-zero exit → throw CliError with stderr\n- Spawn failure → throw SpawnError with system details\n\n### Observability\n- Log every command with requestId (redact secrets)\n- Track duration for each execution\n- Emit events for start/complete/fail\n\n## Acceptance Criteria\n- [ ] Uses execFile, not exec\n- [ ] Timeout enforced with process.kill()\n- [ ] Cancellation works via requestId\n- [ ] Errors are typed (TimeoutError, CliError, SpawnError)\n- [ ] All executions logged with correlation ID\n- [ ] Unit tests cover: success, timeout, cancellation, errors\n\n## Files\n- src/lib/server/cli/process-supervisor.ts\n- src/lib/server/cli/errors.ts\n- src/lib/server/cli/__tests__/process-supervisor.test.ts\n\n## References\n- INTEGRATION_PLAN D0.5: Process Supervisor Pattern\n- Node docs: child_process.execFile, child_process.spawn","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:09:24.755504+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:09:24.755504+05:30","labels":["layer:foundation","phase:1","priority:critical"],"dependencies":[{"issue_id":"hq-0qb.1","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:09:24.756231+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb.2","title":"Implement Concurrency Limiter for CLI operations","description":"# Concurrency Limiter Implementation\n\n## Background\nWithout concurrency limits, rapid API requests can spawn dozens of CLI processes,\nexhausting system resources and causing CPU spikes. The limiter ensures at most\nN processes run simultaneously.\n\n## Why This Matters\n- gt/bd commands are CPU-intensive\n- Parallel execution causes resource contention\n- Sequential with queue is safer for shared state\n- Deduplication prevents redundant work\n\n## Implementation Requirements\n\n### Core API\n```typescript\ninterface ConcurrencyLimiter {\n  acquire\u003cT\u003e(key: string, fn: () =\u003e Promise\u003cT\u003e): Promise\u003cT\u003e;\n  getStats(): QueueStats;\n}\n\ninterface QueueStats {\n  active: number;\n  waiting: number;\n  maxConcurrent: number;\n}\n```\n\n### Features\n1. **Configurable limit**: Default 4, configurable via env\n2. **Keyed deduplication**: Same key → coalesce to single request\n3. **FIFO queue**: Fair ordering for waiting requests\n4. **Timeout**: Requests waiting too long get rejected\n5. **Stats**: Expose active/waiting counts for monitoring\n\n### Deduplication Logic\n```typescript\n// If same key already in-flight, return existing promise\nconst existing = inFlight.get(key);\nif (existing) return existing;\n\n// Otherwise queue new request\nconst promise = queue.add(() =\u003e fn());\ninFlight.set(key, promise);\nreturn promise;\n```\n\n## Acceptance Criteria\n- [ ] Max concurrent configurable (default 4)\n- [ ] Requests beyond limit are queued\n- [ ] Same-key requests deduplicated\n- [ ] Queue timeout rejects stale requests\n- [ ] Stats endpoint returns queue state\n- [ ] Unit tests for: limit enforcement, deduplication, timeout\n\n## Files\n- src/lib/server/cli/concurrency-limiter.ts\n- src/lib/server/cli/__tests__/concurrency-limiter.test.ts\n\n## References\n- INTEGRATION_PLAN D0.3: CLI Operations Concurrency\n- npm: p-limit, p-queue (reference implementations)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:09:38.77385+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:09:38.77385+05:30","labels":["layer:foundation","phase:1"],"dependencies":[{"issue_id":"hq-0qb.2","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:09:38.774526+05:30","created_by":"Avyukth"},{"issue_id":"hq-0qb.2","depends_on_id":"hq-0qb.1","type":"blocks","created_at":"2026-01-12T22:09:38.775584+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb.3","title":"Implement Capabilities Probe for CLI version detection","description":"# Capabilities Probe Implementation\n\n## Background\nThe Capabilities Probe detects CLI version and available features at startup.\nThis enables graceful degradation when CLI versions differ between environments.\n\n## Why This Matters\n- CLI changes over time (new flags, changed output)\n- UI needs to know what features are available\n- Graceful degradation better than hard failures\n- Enables feature flags based on CLI version\n\n## Implementation Requirements\n\n### Probe Logic\n```typescript\ninterface Capabilities {\n  gtVersion: string;       // \"1.2.3\"\n  bdVersion: string;       // \"1.0.0\"\n  features: {\n    jsonOutput: boolean;   // Supports --json flag\n    mailInbox: boolean;    // gt mail inbox works (false if Node hang bug)\n    sseTailing: boolean;   // .events.jsonl exists\n    convoys: boolean;      // Convoy support available\n    formulas: boolean;     // Formula/molecule support\n  };\n  paths: {\n    workspace: string;     // Gas Town workspace path\n    beadsDb: string;       // .beads/ directory\n    eventsFile: string;    // .beads/.events.jsonl (if exists)\n  };\n}\n```\n\n### Detection Methods\n1. **Version**: Run `gt version` and `bd version`\n2. **JSON support**: Run `gt status --json` and check for valid JSON\n3. **Mail bug**: Probe with short timeout, set feature=false if hangs\n4. **SSE tailing**: Check if .events.jsonl exists\n5. **Paths**: Auto-discover from environment\n\n### Caching\n- Probe once at server startup\n- Re-probe on explicit refresh request\n- Cache for 1 hour (version unlikely to change)\n\n## Acceptance Criteria\n- [ ] Detects gt and bd versions\n- [ ] Probes all feature flags\n- [ ] Handles missing commands gracefully\n- [ ] Caches results appropriately\n- [ ] Exposed via /api/gastown/capabilities endpoint\n- [ ] Unit tests mock CLI responses\n\n## Files\n- src/lib/server/cli/capabilities.ts\n- src/lib/server/cli/__tests__/capabilities.test.ts\n- src/routes/api/gastown/capabilities/+server.ts\n\n## References\n- INTEGRATION_PLAN D0.6: Capabilities Probe + CLI Contracts","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:10:02.523894+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:10:02.523894+05:30","labels":["layer:foundation","phase:1"],"dependencies":[{"issue_id":"hq-0qb.3","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:10:02.524514+05:30","created_by":"Avyukth"},{"issue_id":"hq-0qb.3","depends_on_id":"hq-0qb.1","type":"blocks","created_at":"2026-01-12T22:10:02.525601+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb.4","title":"Implement Circuit Breaker for CLI failures","description":"# Circuit Breaker Implementation\n\n## Background\nWhen CLI commands fail repeatedly, continuing to call them wastes resources and\ndelays error responses. A circuit breaker \"trips\" after N failures, failing fast\nuntil the circuit resets.\n\n## Why This Matters\n- Prevents cascading failures\n- Fast fails when CLI is down\n- Auto-recovery when CLI comes back\n- Better UX (fast error vs hanging)\n\n## Implementation Requirements\n\n### States\n```\nCLOSED → (N failures) → OPEN → (timeout) → HALF_OPEN → (success) → CLOSED\n                                         → (failure) → OPEN\n```\n\n### Core API\n```typescript\ninterface CircuitBreaker\u003cT\u003e {\n  call(fn: () =\u003e Promise\u003cT\u003e): Promise\u003cT\u003e;\n  getState(): 'closed' | 'open' | 'half_open';\n  getStats(): CircuitStats;\n  reset(): void;\n}\n\ninterface CircuitStats {\n  state: 'closed' | 'open' | 'half_open';\n  failures: number;\n  successes: number;\n  lastFailure?: Date;\n  lastSuccess?: Date;\n}\n```\n\n### Configuration\n```typescript\ninterface CircuitConfig {\n  failureThreshold: number;   // Failures before open (default 5)\n  successThreshold: number;   // Successes to close (default 2)\n  timeout: number;            // Time before half-open (default 30s)\n}\n```\n\n### Per-Command Breakers\n- Each CLI command has its own circuit breaker\n- gt mail inbox might be open (known bug)\n- gt status might be closed (working fine)\n\n## Acceptance Criteria\n- [ ] Three states: closed, open, half_open\n- [ ] Opens after N consecutive failures\n- [ ] Auto-transitions to half_open after timeout\n- [ ] Closes after N successes in half_open\n- [ ] Per-command breakers supported\n- [ ] Stats exposed for monitoring\n- [ ] Unit tests cover all state transitions\n\n## Files\n- src/lib/server/cli/circuit-breaker.ts\n- src/lib/server/cli/__tests__/circuit-breaker.test.ts\n\n## References\n- INTEGRATION_PLAN D2.4: Effect.ts Error Handling\n- Pattern: Martin Fowler's Circuit Breaker","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:10:02.781025+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:10:02.781025+05:30","labels":["layer:foundation","phase:1"],"dependencies":[{"issue_id":"hq-0qb.4","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:10:02.781617+05:30","created_by":"Avyukth"},{"issue_id":"hq-0qb.4","depends_on_id":"hq-0qb.1","type":"blocks","created_at":"2026-01-12T22:10:02.782692+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb.5","title":"Define Zod CLI Contracts for output validation","description":"# Zod CLI Contracts Implementation\n\n## Background\nCLI output formats can change between versions. Zod contracts validate that CLI\nJSON output matches expected schemas, enabling graceful handling of schema drift.\n\n## Why This Matters\n- CLI output is a contract between CLI and UI\n- Without validation, parsing errors cause crashes\n- Schema drift causes silent data corruption\n- Contracts enable \"schema mismatch\" errors vs crashes\n\n## Implementation Requirements\n\n### Contract Definitions\n```typescript\n// src/lib/server/cli/contracts.ts\n\nimport { z } from 'zod';\n\nexport const StatusContract = z.object({\n  workspace: z.string(),\n  agents: z.array(z.object({\n    name: z.string(),\n    type: z.string(),\n    status: z.enum(['running', 'idle', 'stopped'])\n  })),\n  rigs: z.array(z.object({\n    name: z.string(),\n    path: z.string()\n  }))\n});\n\nexport const WorkItemContract = z.object({\n  id: z.string(),\n  title: z.string(),\n  status: z.string(),\n  priority: z.number(),\n  issue_type: z.string(),\n  // ... more fields\n}).passthrough(); // Allow extra fields for forward compat\n\nexport const ConvoyContract = z.object({\n  id: z.string(),\n  title: z.string(),\n  items: z.array(z.string()),\n  status: z.string()\n});\n\n// Export contract types\nexport type Status = z.infer\u003ctypeof StatusContract\u003e;\nexport type WorkItem = z.infer\u003ctypeof WorkItemContract\u003e;\nexport type Convoy = z.infer\u003ctypeof ConvoyContract\u003e;\n```\n\n### Validation Helper\n```typescript\nexport function validateContract\u003cT\u003e(\n  schema: z.ZodType\u003cT\u003e,\n  data: unknown,\n  context: string\n): T {\n  const result = schema.safeParse(data);\n  if (!result.success) {\n    throw new ContractMismatchError(\n      `Contract mismatch for ${context}`,\n      result.error.issues\n    );\n  }\n  return result.data;\n}\n```\n\n### Graceful Degradation\n- passthrough() allows unknown fields (forward compat)\n- Optional fields with defaults for missing data\n- Log mismatches but continue where possible\n\n## Acceptance Criteria\n- [ ] Contracts defined for all CLI JSON outputs\n- [ ] Validation helper with typed errors\n- [ ] passthrough() for forward compatibility\n- [ ] ContractMismatchError with detailed issues\n- [ ] Logging of schema mismatches\n- [ ] Unit tests with valid and invalid inputs\n\n## Files\n- src/lib/server/cli/contracts.ts\n- src/lib/server/cli/errors.ts (ContractMismatchError)\n- src/lib/server/cli/__tests__/contracts.test.ts\n\n## References\n- INTEGRATION_PLAN D0.6: Capabilities Probe + CLI Contracts\n- INTEGRATION_PLAN: Contract Testing section","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:10:26.467117+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:10:26.467117+05:30","labels":["layer:foundation","phase:1"],"dependencies":[{"issue_id":"hq-0qb.5","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:10:26.467815+05:30","created_by":"Avyukth"},{"issue_id":"hq-0qb.5","depends_on_id":"hq-0qb.1","type":"blocks","created_at":"2026-01-12T22:10:26.469025+05:30","created_by":"Avyukth"}]}
{"id":"hq-0qb.6","title":"Implement typed error hierarchy for CLI operations","description":"# Typed Error Hierarchy Implementation\n\n## Background\nAll CLI operations can fail in various ways. A typed error hierarchy enables\nconsistent error handling and informative error responses.\n\n## Error Types\n\n### Base Error\n```typescript\nexport class CliError extends Error {\n  constructor(\n    message: string,\n    public code: string,\n    public requestId: string,\n    public details?: unknown\n  ) {\n    super(message);\n    this.name = 'CliError';\n  }\n\n  toJSON() {\n    return {\n      error: this.code,\n      message: this.message,\n      requestId: this.requestId,\n      details: this.details\n    };\n  }\n}\n```\n\n### Specific Errors\n```typescript\n// CLI command timed out\nexport class TimeoutError extends CliError {\n  constructor(command: string, timeout: number, requestId: string) {\n    super(\n      `Command '${command}' timed out after ${timeout}ms`,\n      'TIMEOUT',\n      requestId,\n      { command, timeout }\n    );\n  }\n}\n\n// CLI exited with non-zero\nexport class ExitError extends CliError {\n  constructor(command: string, exitCode: number, stderr: string, requestId: string) {\n    super(\n      `Command '${command}' failed with exit code ${exitCode}`,\n      'CLI_ERROR',\n      requestId,\n      { command, exitCode, stderr }\n    );\n  }\n}\n\n// JSON parse failed\nexport class ParseError extends CliError {\n  constructor(command: string, output: string, requestId: string) {\n    super(\n      `Failed to parse JSON output from '${command}'`,\n      'PARSE_ERROR',\n      requestId,\n      { command, output: output.substring(0, 500) }\n    );\n  }\n}\n\n// Schema validation failed\nexport class ContractMismatchError extends CliError {\n  constructor(context: string, issues: z.ZodIssue[], requestId: string) {\n    super(\n      `Schema mismatch: ${context}`,\n      'SCHEMA_MISMATCH',\n      requestId,\n      { issues }\n    );\n  }\n}\n\n// Known bug with workaround\nexport class KnownBugError extends CliError {\n  constructor(bug: string, workaround: string, requestId: string) {\n    super(\n      `Known bug: ${bug}. Workaround: ${workaround}`,\n      'KNOWN_BUG',\n      requestId,\n      { bug, workaround }\n    );\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] All error types extend CliError\n- [ ] toJSON() returns consistent error structure\n- [ ] requestId included in all errors\n- [ ] Error codes documented\n- [ ] Unit tests for each error type\n\n## Files\n- src/lib/server/cli/errors.ts\n- src/lib/server/cli/__tests__/errors.test.ts\n\n## References\n- INTEGRATION_PLAN D2.4: Effect.ts Error Handling\n- INTEGRATION_PLAN: Error Codes section","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:10:26.739926+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:10:26.739926+05:30","labels":["layer:foundation","phase:1"],"dependencies":[{"issue_id":"hq-0qb.6","depends_on_id":"hq-0qb","type":"parent-child","created_at":"2026-01-12T22:10:26.74061+05:30","created_by":"Avyukth"}]}
{"id":"hq-1az","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:34:18.387981+05:30","created_by":"deacon","updated_at":"2026-01-12T22:34:18.50083+05:30","closed_at":"2026-01-12T22:34:18.50083+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-1cj","title":"[P1] Documentation: LLM-Friendly \u0026 Developer Guides","description":"# Phase 1 Documentation Layer\n\n## Background\nDocumentation serves two audiences: humans (developers) and LLMs (Claude Code agents).\nThe INTEGRATION_PLAN specifies serving /llms.txt and /llms-full.txt for machine-readable\ncontext.\n\n## Key Innovations (from INTEGRATION_PLAN v5.0)\n1. **LLM-Friendly Docs (D0.9)**: /llms.txt and /llms-full.txt\n2. **API Documentation**: OpenAPI-style endpoint docs\n3. **Architecture Decision Records**: Documenting the \"why\"\n\n## Documentation to Create\n\n### For LLMs\n- static/llms.txt: Concise project index\n- static/llms-full.txt: Full documentation bundle\n- scripts/generate-llms-txt.ts: Generator script\n\n### For Developers\n- docs/ARCHITECTURE.md: System architecture overview\n- docs/API.md: API endpoint reference\n- docs/DEVELOPMENT.md: Development setup guide\n- docs/DEPLOYMENT.md: Deployment guide\n- docs/TROUBLESHOOTING.md: Common issues and fixes\n\n## Why This Matters\n- LLM docs enable Claude Code to work effectively on codebase\n- Developer docs reduce onboarding time\n- ADRs preserve decision context for future maintainers\n- Troubleshooting docs prevent repeated debugging\n\n## Acceptance Criteria\n- [ ] /llms.txt accessible via static route\n- [ ] llms-full.txt includes all markdown docs\n- [ ] Generator script runs in CI on docs changes\n- [ ] Architecture doc matches implementation\n- [ ] API docs cover all endpoints with examples\n- [ ] Troubleshooting includes known CLI bugs\n\n## Architecture Decision References\n- D0.9: LLM-Friendly Docs\n- D4.3: Documentation Strategy\n\n## Dependencies\n- EPIC: API Routes (hq-0er) - for API documentation\n\n## Files to Create/Modify\n- static/llms.txt\n- static/llms-full.txt\n- scripts/generate-llms-txt.ts\n- docs/ARCHITECTURE.md\n- docs/API.md\n- docs/DEVELOPMENT.md\n- docs/DEPLOYMENT.md\n- docs/TROUBLESHOOTING.md","status":"open","priority":2,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:09:03.667892+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:09:03.667892+05:30","labels":["layer:docs","phase:1"],"dependencies":[{"issue_id":"hq-1cj","depends_on_id":"hq-0er","type":"blocks","created_at":"2026-01-12T22:09:03.669354+05:30","created_by":"Avyukth"}]}
{"id":"hq-1cj.1","title":"Create /llms.txt and generator script","description":"# LLM-Friendly Documentation\n\n## Background\nServe /llms.txt and /llms-full.txt for machine-readable context. This helps\nClaude Code and other LLMs work effectively on the codebase.\n\n## Files to Create\n\n### static/llms.txt (Concise Index)\n- Project overview\n- Architecture summary\n- Key files list\n- CLI command reference\n- Known issues\n- Endpoint list\n\n### scripts/generate-llms-txt.ts\n- Collect all markdown docs\n- Generate llms-full.txt with all content\n- Update on docs changes\n\n## CI Integration\nRegenerate on docs/ changes and auto-commit.\n\n## Acceptance Criteria\n- [ ] /llms.txt accessible\n- [ ] /llms-full.txt includes all docs\n- [ ] Generator runs in CI\n- [ ] Updated on docs changes\n\n## Files\n- static/llms.txt\n- static/llms-full.txt\n- scripts/generate-llms-txt.ts\n- .github/workflows/docs.yml\n\n## References\n- INTEGRATION_PLAN D0.9: LLM-Friendly Docs","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:32:05.142558+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:32:05.142558+05:30","labels":["layer:docs","phase:1"],"dependencies":[{"issue_id":"hq-1cj.1","depends_on_id":"hq-1cj","type":"parent-child","created_at":"2026-01-12T22:32:05.143213+05:30","created_by":"Avyukth"}]}
{"id":"hq-1cj.2","title":"Create API documentation","description":"# API Documentation\n\n## Background\nDocument all /api/gastown/* endpoints with request/response examples.\n\n## Content\nFor each endpoint:\n- Method and path\n- Query parameters\n- Request body (if applicable)\n- Response schema\n- Error responses\n- Example request/response\n\n## Acceptance Criteria\n- [ ] All endpoints documented\n- [ ] Examples are accurate\n- [ ] Error codes explained\n\n## Files\n- docs/API.md\n\n## References\n- Epic: hq-0er (API Routes)","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:32:05.454985+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:32:05.454985+05:30","labels":["layer:docs","phase:1"],"dependencies":[{"issue_id":"hq-1cj.2","depends_on_id":"hq-1cj","type":"parent-child","created_at":"2026-01-12T22:32:05.455584+05:30","created_by":"Avyukth"},{"issue_id":"hq-1cj.2","depends_on_id":"hq-0er","type":"blocks","created_at":"2026-01-12T22:32:05.457226+05:30","created_by":"Avyukth"}]}
{"id":"hq-1cj.3","title":"Create Architecture documentation","description":"# Architecture Documentation\n\n## Background\nHigh-level architecture documentation explaining the system design.\n\n## Content\n- System overview diagram\n- Phase 1 CLI Bridge architecture\n- Data flow (SWR, SSE, stores)\n- Key decisions and rationale\n- Component structure\n- File organization\n\n## Acceptance Criteria\n- [ ] Architecture clearly explained\n- [ ] Diagrams included\n- [ ] Rationale documented\n\n## Files\n- docs/ARCHITECTURE.md\n\n## References\n- INTEGRATION_PLAN: Architecture Overview","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:32:05.759603+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:32:05.759603+05:30","labels":["layer:docs","phase:1"],"dependencies":[{"issue_id":"hq-1cj.3","depends_on_id":"hq-1cj","type":"parent-child","created_at":"2026-01-12T22:32:05.760325+05:30","created_by":"Avyukth"}]}
{"id":"hq-43u","title":"Phase 1 API Routes Sprint","description":"# Phase 1 API Routes Sprint\n\nAll /api/gastown/* endpoint implementations.\n\n## Scope\n- Status, Work, Convoys, Mail, Rigs, Queue, Agents endpoints\n- Diagnostics and Capabilities endpoints\n- SSE Feed stream\n\n## Dependencies\nFoundation (hq-ve0) and Data Layer (hq-bto) convoys\n\n## Exit Criteria\nAll API routes implemented with proper error handling.","status":"open","priority":1,"issue_type":"convoy","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:33:19.076339+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:33:19.076339+05:30","labels":["phase:1","sprint:api"],"dependencies":[{"issue_id":"hq-43u","depends_on_id":"hq-ve0","type":"blocks","created_at":"2026-01-12T22:33:19.077791+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-bto","type":"blocks","created_at":"2026-01-12T22:33:19.079268+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.1","type":"tracks","created_at":"2026-01-12T22:33:25.90447+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.2","type":"tracks","created_at":"2026-01-12T22:33:25.99396+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.3","type":"tracks","created_at":"2026-01-12T22:33:26.069299+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.4","type":"tracks","created_at":"2026-01-12T22:33:26.145707+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.5","type":"tracks","created_at":"2026-01-12T22:33:26.223013+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.6","type":"tracks","created_at":"2026-01-12T22:33:26.297029+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.7","type":"tracks","created_at":"2026-01-12T22:33:26.370904+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.8","type":"tracks","created_at":"2026-01-12T22:33:26.448273+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.9","type":"tracks","created_at":"2026-01-12T22:33:26.52475+05:30","created_by":"Avyukth"},{"issue_id":"hq-43u","depends_on_id":"hq-0er.10","type":"tracks","created_at":"2026-01-12T22:33:26.596026+05:30","created_by":"Avyukth"}]}
{"id":"hq-8r4","title":"Phase 1 UI Sprint","description":"# Phase 1 UI Sprint\n\nUI components and pages for Phase 1.\n\n## Scope\n- Operation Center FAB\n- Command Palette\n- Global Search\n- Toast system\n- Error Boundary\n- All page views (Dashboard, Work, Convoys, Mail, Rigs, Queue)\n\n## Dependencies\nData Layer (hq-bto) and API Routes (hq-43u) convoys\n\n## Exit Criteria\nAll UI components and pages implemented, responsive across platforms.","status":"open","priority":1,"issue_type":"convoy","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:33:32.740886+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:33:32.740886+05:30","labels":["phase:1","sprint:ui"],"dependencies":[{"issue_id":"hq-8r4","depends_on_id":"hq-bto","type":"blocks","created_at":"2026-01-12T22:33:32.742367+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-43u","type":"blocks","created_at":"2026-01-12T22:33:32.744055+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.1","type":"tracks","created_at":"2026-01-12T22:33:41.107371+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.2","type":"tracks","created_at":"2026-01-12T22:33:41.184146+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.3","type":"tracks","created_at":"2026-01-12T22:33:41.260916+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.4","type":"tracks","created_at":"2026-01-12T22:33:41.335487+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.5","type":"tracks","created_at":"2026-01-12T22:33:41.412802+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.6","type":"tracks","created_at":"2026-01-12T22:33:41.492623+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.7","type":"tracks","created_at":"2026-01-12T22:33:41.574306+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.8","type":"tracks","created_at":"2026-01-12T22:33:41.647186+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.9","type":"tracks","created_at":"2026-01-12T22:33:41.718306+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.10","type":"tracks","created_at":"2026-01-12T22:33:41.792254+05:30","created_by":"Avyukth"},{"issue_id":"hq-8r4","depends_on_id":"hq-wbe.11","type":"tracks","created_at":"2026-01-12T22:33:41.865216+05:30","created_by":"Avyukth"}]}
{"id":"hq-bpb","title":"[P1] Data Layer: SWR Caching \u0026 Reactive Stores","description":"# Phase 1 Data Layer\n\n## Background\nThe data layer provides instant perceived performance through SWR (Stale-While-Revalidate)\ncaching and reactive Svelte 5 stores. This is critical for UX - users expect sub-100ms\nresponses even when CLI commands take 500ms+.\n\n## Key Innovations (from INTEGRATION_PLAN v5.0)\n1. **SWR Pattern (D0.4)**: Serve stale data instantly, revalidate in background\n2. **Watch-First Updates (D0.7)**: File watchers for .beads/ directory\n3. **Reactive Stores**: Svelte 5 runes ($state, $derived) for reactivity\n\n## Why This Matters\n- CLI commands are slow (500ms-2s typical)\n- Users expect instant feedback\n- SWR gives perceived instant response while keeping data fresh\n- File watchers enable near-real-time updates without polling\n\n## Acceptance Criteria\n- [ ] SWR cache implemented with configurable TTLs\n- [ ] All stores use Svelte 5 runes ($state, $derived)\n- [ ] File watcher monitors .beads/ directory\n- [ ] Invalidation cascades correctly (work change → convoy refresh)\n- [ ] Cache hit rate \u003e 80% in steady state\n- [ ] Background revalidation doesn't block UI\n\n## Architecture Decision References\n- D0.4: SWR Stale-While-Revalidate Caching\n- D0.7: Watch-First Updates\n- D2.2: Cache Invalidation Strategy\n\n## Dependencies\n- EPIC: Foundation Layer (hq-0qb)\n\n## Files to Create/Modify\n- src/lib/stores/swr.ts\n- src/lib/stores/work.svelte.ts\n- src/lib/stores/convoys.svelte.ts\n- src/lib/stores/agents.svelte.ts\n- src/lib/stores/mail.svelte.ts\n- src/lib/stores/operations.svelte.ts\n- src/lib/server/watch/beads-watcher.ts","status":"open","priority":1,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:07:59.755624+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:07:59.755624+05:30","labels":["critical:yes","layer:data","phase:1"],"dependencies":[{"issue_id":"hq-bpb","depends_on_id":"hq-0qb","type":"blocks","created_at":"2026-01-12T22:07:59.77147+05:30","created_by":"Avyukth"}]}
{"id":"hq-bpb.1","title":"Implement SWR cache with configurable TTLs","description":"# SWR Cache Implementation\n\n## Background\nStale-While-Revalidate (SWR) serves cached data immediately while revalidating\nin the background. This provides instant perceived performance even when CLI\ncommands are slow.\n\n## Why This Matters\n- CLI commands take 500ms-2s\n- Users expect instant response\n- SWR shows stale data immediately\n- Background revalidation keeps data fresh\n- Cache hit rate \u003e 80% in steady state\n\n## Implementation Requirements\n\n### Core API\n```typescript\ninterface SWRCache\u003cT\u003e {\n  get(key: string, fetcher: () =\u003e Promise\u003cT\u003e, options?: SWROptions): Promise\u003cT\u003e;\n  invalidate(key: string): void;\n  invalidatePrefix(prefix: string): void;\n  getStats(): CacheStats;\n}\n\ninterface SWROptions {\n  staleTime?: number;      // Time before data is considered stale (default 30s)\n  cacheTime?: number;      // Time before cache entry is deleted (default 5m)\n  revalidateOnMount?: boolean;  // Revalidate when first accessed\n}\n\ninterface CacheStats {\n  hits: number;\n  misses: number;\n  staleHits: number;      // Served stale, revalidating\n  size: number;\n  entries: Map\u003cstring, CacheEntryStats\u003e;\n}\n```\n\n### Behavior\n```\nCache Hit (fresh) → Return immediately\nCache Hit (stale) → Return immediately + trigger background revalidation\nCache Miss → Fetch + cache + return\n```\n\n### Invalidation Cascades\n```typescript\n// When work item changes, invalidate related caches\nonWorkItemChange(id) {\n  cache.invalidate(`work:${id}`);\n  cache.invalidate('work:list');\n  cache.invalidate('convoys:list'); // Convoy might include this item\n}\n```\n\n### TTL Presets\n```typescript\nconst TTL_PRESETS = {\n  status: 5000,        // System status (changes frequently)\n  agents: 10000,       // Agent list (changes occasionally)\n  convoys: 30000,      // Convoy list (changes rarely)\n  work: 10000,         // Work items (changes with activity)\n  mail: 5000,          // Mail (new messages)\n  capabilities: 3600000 // Capabilities (rarely changes)\n};\n```\n\n## Acceptance Criteria\n- [ ] Fresh cache hits return immediately\n- [ ] Stale hits return immediately + revalidate\n- [ ] Cache misses fetch and cache\n- [ ] TTLs configurable per cache key\n- [ ] Invalidation works for single keys and prefixes\n- [ ] Stats track hits/misses/stale\n- [ ] Unit tests cover all scenarios\n\n## Files\n- src/lib/server/cache/swr.ts\n- src/lib/server/cache/__tests__/swr.test.ts\n\n## References\n- INTEGRATION_PLAN D0.4: SWR Stale-While-Revalidate Caching\n- SWR library: https://swr.vercel.app/","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:11:15.623101+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:11:15.623101+05:30","labels":["layer:data","phase:1","priority:critical"],"dependencies":[{"issue_id":"hq-bpb.1","depends_on_id":"hq-bpb","type":"parent-child","created_at":"2026-01-12T22:11:15.624047+05:30","created_by":"Avyukth"}]}
{"id":"hq-bpb.2","title":"Implement Svelte 5 reactive stores with runes","description":"# Svelte 5 Reactive Stores Implementation\n\n## Background\nSvelte 5 introduces runes ($state, $derived, $effect) for reactive state management.\nAll stores should use runes for consistency and optimal reactivity.\n\n## Why This Matters\n- Svelte 5 runes are more efficient than stores\n- Consistent reactivity model across app\n- Better TypeScript inference\n- Fine-grained updates (only affected components re-render)\n\n## Implementation Requirements\n\n### Store Pattern\n```typescript\n// src/lib/stores/work.svelte.ts\n\nimport { SWRCache } from '$lib/server/cache/swr';\n\nclass WorkStore {\n  items = $state\u003cWorkItem[]\u003e([]);\n  loading = $state(false);\n  error = $state\u003cstring | null\u003e(null);\n  \n  // Derived state\n  openItems = $derived(this.items.filter(i =\u003e i.status === 'open'));\n  highPriority = $derived(this.items.filter(i =\u003e i.priority \u003c= 1));\n  byType = $derived(\n    this.items.reduce((acc, item) =\u003e {\n      acc[item.issue_type] = [...(acc[item.issue_type] || []), item];\n      return acc;\n    }, {} as Record\u003cstring, WorkItem[]\u003e)\n  );\n  \n  async fetch() {\n    this.loading = true;\n    this.error = null;\n    try {\n      const response = await fetch('/api/gastown/work');\n      if (!response.ok) throw new Error(await response.text());\n      this.items = await response.json();\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n  \n  invalidate() {\n    // Called when server-side cache is invalidated\n    this.fetch();\n  }\n}\n\nexport const workStore = new WorkStore();\n```\n\n### Stores to Create\n1. **workStore**: Work items (tasks, issues, etc.)\n2. **convoyStore**: Convoys and their items\n3. **agentStore**: Agent status and health\n4. **mailStore**: Mail messages\n5. **rigStore**: Rig list and details\n6. **queueStore**: Merge queue items\n7. **operationsStore**: Running operations (Operation Center)\n\n### SSE Integration\n```typescript\n// Subscribe to SSE for real-time updates\nconst eventSource = new EventSource('/api/gastown/feed/stream');\neventSource.onmessage = (event) =\u003e {\n  const data = JSON.parse(event.data);\n  switch (data.type) {\n    case 'work_changed':\n      workStore.invalidate();\n      break;\n    case 'convoy_changed':\n      convoyStore.invalidate();\n      break;\n    // ...\n  }\n};\n```\n\n## Acceptance Criteria\n- [ ] All stores use Svelte 5 runes\n- [ ] Derived states computed automatically\n- [ ] Loading and error states tracked\n- [ ] SSE integration for real-time updates\n- [ ] TypeScript types inferred correctly\n- [ ] No reactivity warnings in console\n\n## Files\n- src/lib/stores/work.svelte.ts\n- src/lib/stores/convoys.svelte.ts\n- src/lib/stores/agents.svelte.ts\n- src/lib/stores/mail.svelte.ts\n- src/lib/stores/rigs.svelte.ts\n- src/lib/stores/queue.svelte.ts\n- src/lib/stores/operations.svelte.ts\n- src/lib/stores/sse.ts\n\n## References\n- INTEGRATION_PLAN: Reactive Stores section\n- Svelte 5 runes docs","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":180,"created_at":"2026-01-12T22:11:15.922934+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:11:15.922934+05:30","labels":["layer:data","phase:1"],"dependencies":[{"issue_id":"hq-bpb.2","depends_on_id":"hq-bpb","type":"parent-child","created_at":"2026-01-12T22:11:15.923614+05:30","created_by":"Avyukth"}]}
{"id":"hq-bpb.3","title":"Implement .beads/ directory watcher for real-time updates","description":"# Beads Directory Watcher Implementation\n\n## Background\nInstead of polling, we watch the .beads/ directory for changes. When JSONL files\nchange, we invalidate relevant caches and notify connected clients via SSE.\n\n## Why This Matters\n- Polling wastes resources\n- Watching is event-driven (efficient)\n- Near-real-time updates without overhead\n- Changes from CLI immediately reflected in UI\n\n## Implementation Requirements\n\n### Watcher Setup\n```typescript\n// src/lib/server/watch/beads-watcher.ts\n\nimport { watch, type FSWatcher } from 'chokidar';\n\ninterface WatcherConfig {\n  beadsPath: string;        // .beads/ directory\n  debounceMs: number;       // Debounce rapid changes (default 100ms)\n  onWorkChange: () =\u003e void;\n  onConvoyChange: () =\u003e void;\n  onEventAppend: (event: BeadEvent) =\u003e void;\n}\n\nexport function createBeadsWatcher(config: WatcherConfig): FSWatcher {\n  const watcher = watch(config.beadsPath, {\n    persistent: true,\n    ignoreInitial: true,\n    awaitWriteFinish: {\n      stabilityThreshold: 100,\n      pollInterval: 50\n    }\n  });\n\n  watcher.on('change', debounce((path) =\u003e {\n    if (path.includes('.events.jsonl')) {\n      // Tail new events\n      tailNewEvents(path, config.onEventAppend);\n    } else if (path.includes('work') || path.includes('issues')) {\n      config.onWorkChange();\n    } else if (path.includes('convoy')) {\n      config.onConvoyChange();\n    }\n  }, config.debounceMs));\n\n  return watcher;\n}\n```\n\n### Event Tailing\n```typescript\n// Tail .events.jsonl for new events\nlet lastPosition = 0;\n\nfunction tailNewEvents(\n  path: string,\n  onEvent: (event: BeadEvent) =\u003e void\n) {\n  const content = readFileSync(path, 'utf8');\n  const newContent = content.slice(lastPosition);\n  lastPosition = content.length;\n\n  for (const line of newContent.split('\\n').filter(Boolean)) {\n    try {\n      const event = JSON.parse(line);\n      onEvent(event);\n    } catch {\n      // Ignore malformed lines\n    }\n  }\n}\n```\n\n### Integration with SSE\n```typescript\n// When file changes, broadcast to SSE clients\nwatcher = createBeadsWatcher({\n  beadsPath: '/path/to/.beads',\n  onWorkChange: () =\u003e {\n    sseClients.broadcast({ type: 'work_changed' });\n    swrCache.invalidatePrefix('work:');\n  },\n  onConvoyChange: () =\u003e {\n    sseClients.broadcast({ type: 'convoy_changed' });\n    swrCache.invalidatePrefix('convoy:');\n  },\n  onEventAppend: (event) =\u003e {\n    sseClients.broadcast({ type: 'event', data: event });\n  }\n});\n```\n\n## Acceptance Criteria\n- [ ] Watches .beads/ directory for changes\n- [ ] Debounces rapid changes\n- [ ] Tails .events.jsonl for new events\n- [ ] Invalidates SWR cache on changes\n- [ ] Broadcasts to SSE clients\n- [ ] Handles watcher errors gracefully\n- [ ] Unit tests with mock filesystem\n\n## Files\n- src/lib/server/watch/beads-watcher.ts\n- src/lib/server/watch/__tests__/beads-watcher.test.ts\n\n## References\n- INTEGRATION_PLAN D0.7: Watch-First Updates\n- npm: chokidar","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:11:45.557405+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:11:45.557405+05:30","labels":["layer:data","phase:1"],"dependencies":[{"issue_id":"hq-bpb.3","depends_on_id":"hq-bpb","type":"parent-child","created_at":"2026-01-12T22:11:45.558073+05:30","created_by":"Avyukth"},{"issue_id":"hq-bpb.3","depends_on_id":"hq-bpb.1","type":"blocks","created_at":"2026-01-12T22:11:45.559208+05:30","created_by":"Avyukth"}]}
{"id":"hq-bpb.4","title":"Implement Operations Store for Operation Center","description":"# Operations Store Implementation\n\n## Background\nThe Operations Store tracks all long-running operations (rig add, doctor, etc.)\nand provides data for the Operation Center UI component.\n\n## Why This Matters\n- Users need visibility into running operations\n- Cancel functionality requires tracking\n- Retry functionality needs operation history\n- \"Copy debug bundle\" needs operation details\n\n## Implementation Requirements\n\n### Store Structure\n```typescript\n// src/lib/stores/operations.svelte.ts\n\nexport interface Operation {\n  id: string;\n  type: 'rig_add' | 'formula_run' | 'work_create' | 'sling' | 'doctor';\n  status: 'pending' | 'running' | 'completed' | 'failed' | 'cancelled';\n  startedAt: number;\n  completedAt?: number;\n  progress?: number;         // 0-100 percentage\n  logs: string[];            // Streaming logs\n  result?: unknown;          // Success result\n  error?: string;            // Failure message\n  requestId: string;         // For correlation\n}\n\nclass OperationsStore {\n  operations = $state\u003cOperation[]\u003e([]);\n  \n  // Derived\n  running = $derived(this.operations.filter(o =\u003e o.status === 'running'));\n  hasRunning = $derived(this.running.length \u003e 0);\n  recent = $derived(this.operations.slice(0, 10));\n  \n  add(type: Operation['type']): string {\n    const id = crypto.randomUUID();\n    const operation: Operation = {\n      id,\n      type,\n      status: 'pending',\n      startedAt: Date.now(),\n      logs: [],\n      requestId: crypto.randomUUID()\n    };\n    this.operations = [operation, ...this.operations];\n    return id;\n  }\n  \n  updateStatus(id: string, status: Operation['status'], error?: string) {\n    this.operations = this.operations.map(op =\u003e\n      op.id === id\n        ? { ...op, status, error, completedAt: status !== 'running' ? Date.now() : undefined }\n        : op\n    );\n  }\n  \n  updateProgress(id: string, progress: number) {\n    this.operations = this.operations.map(op =\u003e\n      op.id === id ? { ...op, progress } : op\n    );\n  }\n  \n  appendLog(id: string, message: string) {\n    this.operations = this.operations.map(op =\u003e\n      op.id === id ? { ...op, logs: [...op.logs, message] } : op\n    );\n  }\n  \n  cancel(id: string) {\n    dispatchEvent(new CustomEvent('cancel-operation', { detail: { id } }));\n    this.updateStatus(id, 'cancelled');\n  }\n  \n  retry(id: string) {\n    const original = this.operations.find(op =\u003e op.id === id);\n    if (original) {\n      dispatchEvent(new CustomEvent('retry-operation', { detail: { operation: original } }));\n    }\n  }\n  \n  clearCompleted() {\n    this.operations = this.operations.filter(op =\u003e\n      op.status === 'running' || op.status === 'pending'\n    );\n  }\n}\n\nexport const operationsStore = new OperationsStore();\n```\n\n### Debug Bundle\n```typescript\nfunction getDebugBundle(operation: Operation): string {\n  return JSON.stringify({\n    operation,\n    timestamp: new Date().toISOString(),\n    userAgent: navigator.userAgent,\n    url: window.location.href\n  }, null, 2);\n}\n```\n\n## Acceptance Criteria\n- [ ] Tracks all long-running operations\n- [ ] Progress updates supported\n- [ ] Log streaming supported\n- [ ] Cancel and retry work\n- [ ] Clear completed operations\n- [ ] Debug bundle generation\n- [ ] Svelte 5 runes used\n\n## Files\n- src/lib/stores/operations.svelte.ts\n- src/lib/stores/__tests__/operations.test.ts\n\n## References\n- INTEGRATION_PLAN D0.10: Observable Operations\n- INTEGRATION_PLAN: Operations Store section","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:11:45.84158+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:11:45.84158+05:30","labels":["layer:data","phase:1","priority:critical"],"dependencies":[{"issue_id":"hq-bpb.4","depends_on_id":"hq-bpb","type":"parent-child","created_at":"2026-01-12T22:11:45.842358+05:30","created_by":"Avyukth"}]}
{"id":"hq-bto","title":"Phase 1 Data Layer Sprint","description":"# Phase 1 Data Layer Sprint\n\nData layer work including SWR caching, reactive stores, and file watchers.\n\n## Scope\n- SWR Cache implementation\n- Svelte 5 reactive stores\n- Beads directory watcher\n- Operations store\n\n## Dependencies\nFoundation convoy (hq-ve0)\n\n## Exit Criteria\nAll data layer components implemented and unit tested.","status":"open","priority":1,"issue_type":"convoy","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:33:05.94353+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:33:05.94353+05:30","labels":["phase:1","sprint:data"],"dependencies":[{"issue_id":"hq-bto","depends_on_id":"hq-ve0","type":"blocks","created_at":"2026-01-12T22:33:05.944826+05:30","created_by":"Avyukth"},{"issue_id":"hq-bto","depends_on_id":"hq-bpb.1","type":"tracks","created_at":"2026-01-12T22:33:12.442709+05:30","created_by":"Avyukth"},{"issue_id":"hq-bto","depends_on_id":"hq-bpb.2","type":"tracks","created_at":"2026-01-12T22:33:12.511509+05:30","created_by":"Avyukth"},{"issue_id":"hq-bto","depends_on_id":"hq-bpb.3","type":"tracks","created_at":"2026-01-12T22:33:12.589091+05:30","created_by":"Avyukth"},{"issue_id":"hq-bto","depends_on_id":"hq-bpb.4","type":"tracks","created_at":"2026-01-12T22:33:12.662093+05:30","created_by":"Avyukth"}]}
{"id":"hq-crew-role","title":"Crew Role","description":"Role definition for Crew agents. Persistent user-managed workspaces.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:45.321941+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:45.321941+05:30","labels":["gt:role"]}
{"id":"hq-d9e","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:15:57.975691+05:30","created_by":"deacon","updated_at":"2026-01-12T22:15:58.296918+05:30","closed_at":"2026-01-12T22:15:58.296918+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-deacon","title":"Deacon (daemon beacon) - receives mechanical heartbeats, runs town plugins and monitoring.","description":"Deacon (daemon beacon) - receives mechanical heartbeats, runs town plugins and monitoring.\n\nrole_type: deacon\nrig: null\nagent_state: idle\nhook_bead: null\nrole_bead: hq-deacon-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:45.768519+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:45.859734+05:30","labels":["gt:agent"]}
{"id":"hq-deacon-role","title":"Deacon Role","description":"Role definition for Deacon agents. Daemon beacon for heartbeats and monitoring.","status":"closed","priority":2,"issue_type":"role","assignee":"deacon/","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:44.420677+05:30","created_by":"Avyukth","updated_at":"2026-01-12T20:56:22.210966+05:30","closed_at":"2026-01-12T20:56:22.210966+05:30","close_reason":"Created mol-deacon-patrol formula with 3 steps: inbox-check, health-scan, loop-or-exit","labels":["gt:role"]}
{"id":"hq-dog-role","title":"Dog Role","description":"Role definition for Dog agents. Town-level workers for cross-rig tasks.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:44.600357+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:44.600357+05:30","labels":["gt:role"]}
{"id":"hq-f6s","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T20:56:49.776679+05:30","created_by":"deacon","updated_at":"2026-01-12T20:56:49.849699+05:30","closed_at":"2026-01-12T20:56:49.849699+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-fkt","title":"Phase 1 Testing \u0026 Docs Sprint","description":"# Phase 1 Testing \u0026 Documentation Sprint\n\nTesting and documentation work for Phase 1.\n\n## Scope\n- Unit tests for all components\n- Integration tests for API routes\n- CUJ verification checklists\n- LLM-friendly docs\n- API and Architecture docs\n\n## Dependencies\nAll other Phase 1 convoys (implementation must exist to test)\n\n## Exit Criteria\nAll tests passing, documentation complete.","status":"open","priority":2,"issue_type":"convoy","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:33:48.799297+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:33:48.799297+05:30","labels":["phase:1","sprint:testing"],"dependencies":[{"issue_id":"hq-fkt","depends_on_id":"hq-ve0","type":"blocks","created_at":"2026-01-12T22:33:48.80082+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-bto","type":"blocks","created_at":"2026-01-12T22:33:48.80304+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-43u","type":"blocks","created_at":"2026-01-12T22:33:48.804841+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-8r4","type":"blocks","created_at":"2026-01-12T22:33:48.806502+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-nbf.1","type":"tracks","created_at":"2026-01-12T22:33:55.322777+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-nbf.2","type":"tracks","created_at":"2026-01-12T22:33:55.510803+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-nbf.3","type":"tracks","created_at":"2026-01-12T22:33:55.646072+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-nbf.4","type":"tracks","created_at":"2026-01-12T22:33:55.753721+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-nbf.5","type":"tracks","created_at":"2026-01-12T22:33:55.905458+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-1cj.1","type":"tracks","created_at":"2026-01-12T22:33:56.026644+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-1cj.2","type":"tracks","created_at":"2026-01-12T22:33:56.130602+05:30","created_by":"Avyukth"},{"issue_id":"hq-fkt","depends_on_id":"hq-1cj.3","type":"tracks","created_at":"2026-01-12T22:33:56.318219+05:30","created_by":"Avyukth"}]}
{"id":"hq-hh5","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T21:59:38.747334+05:30","created_by":"deacon","updated_at":"2026-01-12T21:59:38.80718+05:30","closed_at":"2026-01-12T21:59:38.80718+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-mayor","title":"Mayor - global coordinator, handles cross-rig communication and escalations.","description":"Mayor - global coordinator, handles cross-rig communication and escalations.\n\nrole_type: mayor\nrig: null\nagent_state: idle\nhook_bead: null\nrole_bead: hq-mayor-role\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:45.529274+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:45.627239+05:30","labels":["gt:agent"]}
{"id":"hq-mayor-role","title":"Mayor Role","description":"Role definition for Mayor agents. Global coordinator for cross-rig work.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:44.246007+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:44.246007+05:30","labels":["gt:role"]}
{"id":"hq-mcl","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T21:08:17.577624+05:30","created_by":"deacon","updated_at":"2026-01-12T21:08:17.632278+05:30","closed_at":"2026-01-12T21:08:17.632278+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-nbf","title":"[P1] Testing: Unit, Integration \u0026 Manual Verification","description":"# Phase 1 Testing Layer\n\n## Background\nTesting ensures reliability and prevents regressions. The INTEGRATION_PLAN specifies\na comprehensive testing strategy with unit tests, integration tests, and manual\nverification checklists.\n\n## Testing Strategy (from INTEGRATION_PLAN v5.0)\n\n### Unit Tests (Vitest)\n- Process Supervisor: spawn behavior, timeout handling\n- SWR Cache: TTL expiry, invalidation, race conditions\n- Stores: reactive updates, computed values\n- CLI Contracts: Zod schema validation\n\n### Integration Tests (Vitest)\n- API routes with mocked CLI\n- SSE stream behavior\n- Error propagation\n\n### Manual Verification (No Playwright - repo posture)\n- CUJ-1: Rig Management flow\n- CUJ-2: Work Item Lifecycle flow\n- CUJ-3: Sling (Orchestration) flow\n- CUJ-4: System Monitoring flow\n- CUJ-5: Mail View flow\n\n## Why This Matters\n- Unit tests catch logic errors early\n- Integration tests verify component interaction\n- Manual CUJ verification ensures real-world usability\n- Contract tests prevent CLI output format regressions\n\n## Acceptance Criteria\n- [ ] Unit test coverage \u003e 80% for server code\n- [ ] All API routes have integration tests\n- [ ] CUJ verification checklists documented\n- [ ] Contract tests for all CLI JSON outputs\n- [ ] Test fixtures for known CLI outputs\n- [ ] CI runs tests on every PR\n\n## Architecture Decision References\n- D4.1: Testing Strategy\n- D4.2: CI/CD Requirements\n\n## Dependencies\n- EPIC: Foundation Layer (hq-0qb)\n- EPIC: Data Layer (hq-bpb)\n- EPIC: API Routes (hq-0er)\n- EPIC: UI Layer (hq-wbe)\n\n## Files to Create/Modify\n- src/lib/server/cli/__tests__/process-supervisor.test.ts\n- src/lib/server/cli/__tests__/capabilities.test.ts\n- src/lib/stores/__tests__/swr.test.ts\n- src/routes/api/gastown/__tests__/*.test.ts\n- docs/TESTING.md\n- docs/CUJ_VERIFICATION.md","status":"open","priority":2,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:08:50.545248+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:08:50.545248+05:30","labels":["layer:testing","phase:1"],"dependencies":[{"issue_id":"hq-nbf","depends_on_id":"hq-0qb","type":"blocks","created_at":"2026-01-12T22:08:50.547044+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf","depends_on_id":"hq-bpb","type":"blocks","created_at":"2026-01-12T22:08:50.5483+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf","depends_on_id":"hq-0er","type":"blocks","created_at":"2026-01-12T22:08:50.549183+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf","depends_on_id":"hq-wbe","type":"blocks","created_at":"2026-01-12T22:08:50.549966+05:30","created_by":"Avyukth"}]}
{"id":"hq-nbf.1","title":"Unit tests: Process Supervisor","description":"# Unit Tests: Process Supervisor\n\n## Test Cases\n\n### Success Cases\n- [x] Executes command and returns stdout\n- [x] Captures stderr separately\n- [x] Returns exit code\n- [x] Measures execution duration\n- [x] Generates unique requestId\n\n### Timeout Cases\n- [x] Throws TimeoutError after timeout\n- [x] Kills process on timeout\n- [x] Returns partial output on timeout\n- [x] Custom timeout respected\n\n### Cancellation Cases\n- [x] Cancel by requestId works\n- [x] Cancelled process killed\n- [x] Throws CancellationError\n\n### Error Cases\n- [x] Non-zero exit throws ExitError\n- [x] Spawn failure throws SpawnError\n- [x] Invalid command throws appropriate error\n\n### Concurrency Cases\n- [x] Multiple processes run concurrently\n- [x] Each has unique requestId\n\n## Test Setup\n```typescript\nimport { describe, it, expect, vi } from 'vitest';\nimport { ProcessSupervisor } from '../process-supervisor';\n\ndescribe('ProcessSupervisor', () =\u003e {\n  const supervisor = new ProcessSupervisor();\n\n  it('executes command and returns stdout', async () =\u003e {\n    const result = await supervisor.run('echo', ['hello']);\n    expect(result.stdout.trim()).toBe('hello');\n    expect(result.exitCode).toBe(0);\n  });\n\n  it('throws TimeoutError after timeout', async () =\u003e {\n    await expect(\n      supervisor.run('sleep', ['10'], { timeout: 100 })\n    ).rejects.toThrow('timed out');\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] Coverage \u003e 90%\n- [ ] Tests run fast (mocked where needed)\n\n## Files\n- src/lib/server/cli/__tests__/process-supervisor.test.ts\n\n## References\n- Task: hq-0qb.1 (Process Supervisor implementation)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:31:23.396424+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:31:23.396424+05:30","labels":["layer:testing","phase:1","type:unit"],"dependencies":[{"issue_id":"hq-nbf.1","depends_on_id":"hq-nbf","type":"parent-child","created_at":"2026-01-12T22:31:23.39714+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf.1","depends_on_id":"hq-0qb.1","type":"blocks","created_at":"2026-01-12T22:31:23.399376+05:30","created_by":"Avyukth"}]}
{"id":"hq-nbf.2","title":"Unit tests: SWR Cache","description":"# Unit Tests: SWR Cache\n\n## Test Cases\n\n### Fresh Cache\n- [x] Cache miss calls fetcher\n- [x] Cache hit returns cached data\n- [x] Fresh data returned immediately\n\n### Stale Cache\n- [x] Stale data returned immediately\n- [x] Background revalidation triggered\n- [x] Cache updated after revalidation\n\n### Invalidation\n- [x] Single key invalidation works\n- [x] Prefix invalidation works\n- [x] Invalidated keys refetch on next access\n\n### TTL\n- [x] Data becomes stale after staleTime\n- [x] Data deleted after cacheTime\n- [x] Custom TTLs respected\n\n### Race Conditions\n- [x] Concurrent requests deduplicated\n- [x] Revalidation doesn't block reads\n\n## Test Setup\n```typescript\nimport { describe, it, expect, vi } from 'vitest';\nimport { SWRCache } from '../swr';\n\ndescribe('SWRCache', () =\u003e {\n  it('returns cached data on hit', async () =\u003e {\n    const cache = new SWRCache();\n    const fetcher = vi.fn().mockResolvedValue({ data: 'test' });\n\n    await cache.get('key', fetcher);\n    const result = await cache.get('key', fetcher);\n\n    expect(fetcher).toHaveBeenCalledTimes(1);\n    expect(result).toEqual({ data: 'test' });\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All test cases pass\n- [ ] Coverage \u003e 90%\n- [ ] Race conditions handled correctly\n\n## Files\n- src/lib/server/cache/__tests__/swr.test.ts\n\n## References\n- Task: hq-bpb.1 (SWR Cache implementation)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:31:24.820831+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:31:24.820831+05:30","labels":["layer:testing","phase:1","type:unit"],"dependencies":[{"issue_id":"hq-nbf.2","depends_on_id":"hq-nbf","type":"parent-child","created_at":"2026-01-12T22:31:24.824155+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf.2","depends_on_id":"hq-bpb.1","type":"blocks","created_at":"2026-01-12T22:31:24.826088+05:30","created_by":"Avyukth"}]}
{"id":"hq-nbf.3","title":"Unit tests: Zod CLI Contracts","description":"# Unit Tests: Zod CLI Contracts\n\n## Test Cases\n\n### Valid Inputs\n- [x] Valid status JSON parses\n- [x] Valid work item JSON parses\n- [x] Valid convoy JSON parses\n- [x] Extra fields allowed (passthrough)\n\n### Invalid Inputs\n- [x] Missing required fields rejected\n- [x] Wrong types rejected\n- [x] Detailed error messages returned\n\n### Edge Cases\n- [x] Empty arrays allowed\n- [x] Null values handled\n- [x] Unicode strings work\n\n## Test Fixtures\nInclude real CLI output samples for regression testing.\n\n## Acceptance Criteria\n- [ ] All contracts have tests\n- [ ] Real CLI output fixtures used\n- [ ] Error messages are helpful\n\n## Files\n- src/lib/server/cli/__tests__/contracts.test.ts\n- src/lib/server/cli/__tests__/fixtures/*.json\n\n## References\n- Task: hq-0qb.5 (Zod Contracts implementation)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:31:48.406986+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:31:48.406986+05:30","labels":["layer:testing","phase:1","type:unit"],"dependencies":[{"issue_id":"hq-nbf.3","depends_on_id":"hq-nbf","type":"parent-child","created_at":"2026-01-12T22:31:48.407669+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf.3","depends_on_id":"hq-0qb.5","type":"blocks","created_at":"2026-01-12T22:31:48.409316+05:30","created_by":"Avyukth"}]}
{"id":"hq-nbf.4","title":"Integration tests: API Routes","description":"# Integration Tests: API Routes\n\n## Test Strategy\nMock the CLI (Process Supervisor) and test the full route behavior.\n\n## Test Cases\n\n### /api/gastown/status\n- [x] Returns JSON with expected structure\n- [x] Uses SWR cache\n- [x] Handles CLI errors gracefully\n\n### /api/gastown/work\n- [x] Returns work items\n- [x] Filters work correctly\n- [x] Handles empty results\n\n### /api/gastown/mail\n- [x] Uses bd list workaround\n- [x] Returns messages\n\n### Error Handling\n- [x] CLI timeout returns error response\n- [x] Parse error returns error response\n- [x] RequestId in all error responses\n\n## Test Setup\n```typescript\nimport { describe, it, expect, vi } from 'vitest';\n\n// Mock the process supervisor\nvi.mock('$lib/server/cli/process-supervisor', () =\u003e ({\n  processSupervisor: {\n    run: vi.fn()\n  }\n}));\n\ndescribe('GET /api/gastown/status', () =\u003e {\n  it('returns status JSON', async () =\u003e {\n    processSupervisor.run.mockResolvedValue({\n      stdout: JSON.stringify({ workspace: '/test' }),\n      exitCode: 0\n    });\n\n    const response = await GET({ request: new Request('http://test') });\n    const data = await response.json();\n\n    expect(data.workspace).toBe('/test');\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All routes have integration tests\n- [ ] Mocks don't leak between tests\n- [ ] Error scenarios covered\n\n## Files\n- src/routes/api/gastown/__tests__/*.test.ts\n\n## References\n- Epic: hq-0er (API Routes)","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":180,"created_at":"2026-01-12T22:31:48.698891+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:31:48.698891+05:30","labels":["layer:testing","phase:1","type:integration"],"dependencies":[{"issue_id":"hq-nbf.4","depends_on_id":"hq-nbf","type":"parent-child","created_at":"2026-01-12T22:31:48.699546+05:30","created_by":"Avyukth"},{"issue_id":"hq-nbf.4","depends_on_id":"hq-0er","type":"blocks","created_at":"2026-01-12T22:31:48.701296+05:30","created_by":"Avyukth"}]}
{"id":"hq-nbf.5","title":"Create CUJ verification checklists","description":"# CUJ Verification Checklists\n\n## Background\nManual verification checklists for Critical User Journeys. Since we don't use\nPlaywright (repo posture), these are manual QA guides.\n\n## CUJ-1: Rig Management\n- [ ] Open Rigs page\n- [ ] See list of rigs with agent counts\n- [ ] Expand rig to see details\n- [ ] Agent status indicators correct\n\n## CUJ-2: Work Item Lifecycle\n- [ ] Open Work Items page\n- [ ] Filter by type, status, priority\n- [ ] Search by title\n- [ ] Click item to see details\n- [ ] Details panel shows all fields\n\n## CUJ-3: Sling (Orchestration)\n- [ ] View pending work items\n- [ ] See available agents\n- [ ] (Phase 2: Sling work to agent)\n\n## CUJ-4: System Monitoring\n- [ ] Dashboard shows agent status\n- [ ] Recent activity feed updates\n- [ ] Health indicators accurate\n- [ ] Degraded mode banner on disconnect\n\n## CUJ-5: Mail View\n- [ ] Open Mail page\n- [ ] See inbox with unread indicators\n- [ ] Click message to view\n- [ ] Message content renders\n\n## Platform Matrix\nRun each CUJ on:\n- [ ] Mobile (360×800)\n- [ ] Tablet (768×1024)\n- [ ] Desktop (1440×900)\n\n## Acceptance Criteria\n- [ ] All CUJs documented\n- [ ] Platform matrix defined\n- [ ] Checklist usable for QA\n\n## Files\n- docs/CUJ_VERIFICATION.md\n\n## References\n- INTEGRATION_PLAN: Manual Verification Checklists","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:31:49.005587+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:31:49.005587+05:30","labels":["layer:testing","phase:1","type:manual"],"dependencies":[{"issue_id":"hq-nbf.5","depends_on_id":"hq-nbf","type":"parent-child","created_at":"2026-01-12T22:31:49.006185+05:30","created_by":"Avyukth"}]}
{"id":"hq-p30","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T21:42:31.425411+05:30","created_by":"deacon","updated_at":"2026-01-12T21:42:31.489467+05:30","closed_at":"2026-01-12T21:42:31.489467+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-polecat-role","title":"Polecat Role","description":"Role definition for Polecat agents. Ephemeral workers for batch work dispatch.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:45.147955+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:45.147955+05:30","labels":["gt:role"]}
{"id":"hq-refinery-role","title":"Refinery Role","description":"Role definition for Refinery agents. Merge queue processor with verification gates.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:44.975786+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:44.975786+05:30","labels":["gt:role"]}
{"id":"hq-t4i","title":"Session ended: gt-deacon","status":"closed","priority":2,"issue_type":"event","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T21:25:30.37442+05:30","created_by":"deacon","updated_at":"2026-01-12T21:25:30.435193+05:30","closed_at":"2026-01-12T21:25:30.435193+05:30","close_reason":"auto-closed session cost wisp","ephemeral":true}
{"id":"hq-ve0","title":"Phase 1 Foundation Sprint","description":"# Phase 1 Foundation Sprint\n\nCritical path work for the foundation layer. Must complete before data/API layers.\n\n## Scope\n- Process Supervisor\n- Concurrency Limiter\n- Capabilities Probe\n- Circuit Breaker\n- Zod Contracts\n- Error Hierarchy\n\n## Dependencies\nNone - this is the first convoy.\n\n## Exit Criteria\nAll foundation components implemented and unit tested.","status":"open","priority":1,"issue_type":"convoy","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:32:21.24403+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:32:21.24403+05:30","labels":["phase:1","sprint:foundation"],"dependencies":[{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.1","type":"tracks","created_at":"2026-01-12T22:32:57.201369+05:30","created_by":"Avyukth"},{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.2","type":"tracks","created_at":"2026-01-12T22:32:57.275632+05:30","created_by":"Avyukth"},{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.3","type":"tracks","created_at":"2026-01-12T22:32:57.353699+05:30","created_by":"Avyukth"},{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.4","type":"tracks","created_at":"2026-01-12T22:32:57.426587+05:30","created_by":"Avyukth"},{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.5","type":"tracks","created_at":"2026-01-12T22:32:57.500476+05:30","created_by":"Avyukth"},{"issue_id":"hq-ve0","depends_on_id":"hq-0qb.6","type":"tracks","created_at":"2026-01-12T22:32:57.581816+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe","title":"[P1] UI Layer: Components \u0026 Operation Center","description":"# Phase 1 UI Layer\n\n## Background\nThe UI layer provides the visual interface for monitoring and controlling Gas Town.\nAll components must work across mobile, tablet, and desktop (per AGENTS.md platform taxonomy).\n\n## Key Innovations (from INTEGRATION_PLAN v5.0)\n1. **Operation Center (D0.10)**: Bottom-right FAB showing running operations\n2. **Power-User Ergonomics (D0.8)**: Command Palette, Global Search, Copy CLI\n3. **Accessibility**: WCAG 2.2 AA compliance, keyboard navigation\n\n## Components to Build\n\n### Core Views\n- Dashboard: System overview with agent status\n- Convoys: Convoy list with filtering\n- Work Items: Task/issue browser with search\n- Mail: Message inbox/outbox\n- Rigs: Rig management view\n- Queue: Merge queue visualization\n\n### UI Primitives\n- Operation Center FAB (running operations indicator)\n- Toast notifications (success, error, info)\n- Command Palette (Cmd+K)\n- Global Search (Cmd+/)\n- Error boundaries with recovery\n- Loading skeletons (no spinners!)\n\n## Why This Matters\n- Operation Center provides at-a-glance operation status\n- Command Palette enables power users to navigate faster\n- Skeletons prevent layout shift (better Core Web Vitals)\n- Error boundaries prevent cascading UI failures\n\n## Acceptance Criteria\n- [ ] All views render on mobile, tablet, desktop (AGENTS.md platforms)\n- [ ] Operation Center shows running/completed operations\n- [ ] Command Palette accessible via Cmd+K\n- [ ] Tab navigation works through all interactive elements\n- [ ] Loading states use skeletons, not spinners\n- [ ] Error boundaries catch and display errors gracefully\n- [ ] Reduced motion respected for animations\n\n## Architecture Decision References\n- D0.8: Power-User Ergonomics\n- D0.10: Observable Operations (Operation Center)\n- D3.2: UI Component Strategy\n\n## Dependencies\n- EPIC: Data Layer (hq-bpb)\n- EPIC: API Routes (hq-0er)\n\n## Files to Create/Modify\n- src/lib/components/OperationCenter.svelte\n- src/lib/components/CommandPalette.svelte\n- src/lib/components/GlobalSearch.svelte\n- src/lib/components/Toast.svelte\n- src/lib/components/ErrorBoundary.svelte\n- src/routes/dashboard/+page.svelte\n- src/routes/convoys/+page.svelte\n- src/routes/work/+page.svelte\n- src/routes/mail/+page.svelte\n- src/routes/rigs/+page.svelte\n- src/routes/queue/+page.svelte","status":"open","priority":1,"issue_type":"epic","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T22:08:29.842619+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:08:29.842619+05:30","labels":["critical:yes","layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe","depends_on_id":"hq-bpb","type":"blocks","created_at":"2026-01-12T22:08:29.844342+05:30","created_by":"Avyukth"},{"issue_id":"hq-wbe","depends_on_id":"hq-0er","type":"blocks","created_at":"2026-01-12T22:08:29.845302+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.1","title":"Implement Operation Center FAB component","description":"# Operation Center FAB Implementation\n\n## Background\nThe Operation Center is a floating action button (FAB) in the bottom-right corner\nthat shows running operations and provides quick access to operation history.\n\n## UI Behavior\n- Collapsed: Shows icon + count of running operations\n- Expanded: Shows list of recent operations with details\n- Running operations show progress bar and cancel button\n- Failed operations show error and retry button\n\n## Component Structure\n```svelte\n\u003c!-- src/lib/components/OperationCenter.svelte --\u003e\n\n\u003cscript lang=\"ts\"\u003e\n  import { operationsStore } from '$lib/stores/operations.svelte';\n  \n  let expanded = $state(false);\n  \n  const hasRunning = $derived(operationsStore.hasRunning);\n  const runningOps = $derived(operationsStore.running);\n  const recentOps = $derived(operationsStore.recent);\n\u003c/script\u003e\n\n\u003cdiv class=\"operation-center\" class:expanded\u003e\n  \u003cbutton class=\"toggle-btn\" onclick={() =\u003e expanded = !expanded}\u003e\n    \u003cspan class=\"icon\"\u003e{hasRunning ? '⏳' : '✓'}\u003c/span\u003e\n    \u003cspan class=\"label\"\u003e\n      {#if hasRunning}\n        {runningOps.length} running\n      {:else}\n        Operations\n      {/if}\n    \u003c/span\u003e\n    \u003cChevronIcon direction={expanded ? 'down' : 'up'} /\u003e\n  \u003c/button\u003e\n\n  {#if expanded}\n    \u003cdiv class=\"panel\"\u003e\n      \u003cheader\u003e\n        \u003ch3\u003eOperation Center\u003c/h3\u003e\n        \u003cbutton onclick={() =\u003e operationsStore.clearCompleted()}\u003e\n          Clear completed\n        \u003c/button\u003e\n      \u003c/header\u003e\n      \n      \u003cul class=\"operation-list\"\u003e\n        {#each recentOps as op (op.id)}\n          \u003cOperationItem {op} /\u003e\n        {:else}\n          \u003cli\u003eNo recent operations\u003c/li\u003e\n        {/each}\n      \u003c/ul\u003e\n    \u003c/div\u003e\n  {/if}\n\u003c/div\u003e\n```\n\n## Features\n- [x] Floating position (bottom-right, z-50)\n- [x] Badge shows running count\n- [x] Expand/collapse panel\n- [x] Operation list with status\n- [x] Progress bar for running ops\n- [x] Cancel button for running ops\n- [x] Retry button for failed ops\n- [x] Logs expandable per operation\n- [x] Copy debug bundle button\n\n## Platform Considerations (AGENTS.md)\n- Mobile: Full-width panel, larger touch targets\n- Tablet: Fixed width panel, standard targets\n- Desktop: Fixed width panel, hover states\n\n## Acceptance Criteria\n- [ ] FAB positioned bottom-right\n- [ ] Shows running operation count\n- [ ] Panel expands/collapses\n- [ ] Operations listed with status icons\n- [ ] Progress bar for running operations\n- [ ] Cancel and retry buttons work\n- [ ] Works on mobile, tablet, desktop\n- [ ] Keyboard accessible (Tab, Enter, Escape)\n\n## Files\n- src/lib/components/OperationCenter.svelte\n- src/lib/components/OperationItem.svelte\n- src/lib/components/__tests__/OperationCenter.test.ts\n\n## References\n- INTEGRATION_PLAN D0.10: Observable Operations\n- INTEGRATION_PLAN: Operation Center UI section","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":180,"created_at":"2026-01-12T22:29:03.736764+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:03.736764+05:30","labels":["layer:ui","phase:1","priority:critical"],"dependencies":[{"issue_id":"hq-wbe.1","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:03.737514+05:30","created_by":"Avyukth"},{"issue_id":"hq-wbe.1","depends_on_id":"hq-bpb.4","type":"blocks","created_at":"2026-01-12T22:29:03.739281+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.10","title":"Implement Rigs page","description":"# Rigs Page Implementation\n\n## Background\nThe Rigs page shows registered project containers with their agents,\npolecats, and crew members.\n\n## Features\n- Rig list with agent counts\n- Expand to see agents/crew\n- Rig health indicators\n- Add rig (Phase 2)\n\n## Acceptance Criteria\n- [ ] Lists rigs with counts\n- [ ] Expandable to show details\n- [ ] Agent status indicators\n- [ ] Loading skeletons\n- [ ] Empty state\n\n## Files\n- src/routes/rigs/+page.svelte\n- src/lib/components/RigCard.svelte\n\n## References\n- INTEGRATION_PLAN: CUJ-1 Rig Management","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:30:08.996392+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:30:08.996392+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.10","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:30:08.996943+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.11","title":"Implement Queue page (merge queue)","description":"# Queue Page Implementation\n\n## Background\nThe Queue page shows the merge queue - branches waiting to be processed\nby the Refinery agent.\n\n## Features\n- Queue list with positions\n- Branch details\n- Queue processing status\n- Manual queue manipulation (Phase 2)\n\n## Acceptance Criteria\n- [ ] Lists queue items with position\n- [ ] Shows branch and rig info\n- [ ] Status indicators\n- [ ] Loading skeletons\n- [ ] Empty queue state\n\n## Files\n- src/routes/queue/+page.svelte\n- src/lib/components/QueueItem.svelte\n\n## References\n- INTEGRATION_PLAN: Queue Endpoint","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:30:09.287284+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:30:09.287284+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.11","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:30:09.287861+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.2","title":"Implement Command Palette (Cmd+K)","description":"# Command Palette Implementation\n\n## Background\nPower users expect keyboard-driven navigation. The Command Palette (Cmd+K) provides\nquick access to all actions and navigation without touching the mouse.\n\n## UI Behavior\n- Trigger: Cmd+K (Mac) / Ctrl+K (Windows/Linux)\n- Modal overlay with search input\n- Fuzzy search across commands\n- Recent commands shown first\n- Keyboard navigation (arrows, Enter, Escape)\n\n## Command Categories\n1. **Navigation**: Go to Dashboard, Convoys, Work, Mail, Rigs, Queue\n2. **Actions**: Create work item, Refresh data, Run doctor\n3. **Search**: Search work items, Search mail\n4. **Settings**: Toggle theme, Open settings\n\n## Component Structure\n```svelte\n\u003c!-- src/lib/components/CommandPalette.svelte --\u003e\n\n\u003cscript lang=\"ts\"\u003e\n  import { goto } from '$app/navigation';\n  \n  let open = $state(false);\n  let query = $state('');\n  let selectedIndex = $state(0);\n  \n  const commands = [\n    { id: 'nav-dashboard', label: 'Go to Dashboard', action: () =\u003e goto('/') },\n    { id: 'nav-work', label: 'Go to Work Items', action: () =\u003e goto('/work') },\n    { id: 'nav-convoys', label: 'Go to Convoys', action: () =\u003e goto('/convoys') },\n    // ...\n  ];\n  \n  const filtered = $derived(\n    query \n      ? commands.filter(c =\u003e fuzzyMatch(c.label, query))\n      : commands\n  );\n  \n  function handleKeydown(event: KeyboardEvent) {\n    if ((event.metaKey || event.ctrlKey) \u0026\u0026 event.key === 'k') {\n      event.preventDefault();\n      open = true;\n    }\n    if (event.key === 'Escape') {\n      open = false;\n    }\n    if (event.key === 'ArrowDown') {\n      selectedIndex = Math.min(selectedIndex + 1, filtered.length - 1);\n    }\n    if (event.key === 'ArrowUp') {\n      selectedIndex = Math.max(selectedIndex - 1, 0);\n    }\n    if (event.key === 'Enter' \u0026\u0026 filtered[selectedIndex]) {\n      filtered[selectedIndex].action();\n      open = false;\n    }\n  }\n\u003c/script\u003e\n\n\u003csvelte:window onkeydown={handleKeydown} /\u003e\n\n{#if open}\n  \u003cdiv class=\"command-palette-overlay\" onclick={() =\u003e open = false}\u003e\n    \u003cdiv class=\"command-palette\" onclick|stopPropagation\u003e\n      \u003cinput\n        type=\"text\"\n        placeholder=\"Type a command...\"\n        bind:value={query}\n        autofocus\n      /\u003e\n      \u003cul\u003e\n        {#each filtered as command, i (command.id)}\n          \u003cli \n            class:selected={i === selectedIndex}\n            onclick={() =\u003e { command.action(); open = false; }}\n          \u003e\n            {command.label}\n          \u003c/li\u003e\n        {/each}\n      \u003c/ul\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n{/if}\n```\n\n## Acceptance Criteria\n- [ ] Opens with Cmd+K / Ctrl+K\n- [ ] Closes with Escape or click outside\n- [ ] Fuzzy search works\n- [ ] Arrow keys navigate\n- [ ] Enter executes command\n- [ ] Recent commands shown first\n- [ ] Accessible (focus trap, aria labels)\n- [ ] Works on all platforms\n\n## Files\n- src/lib/components/CommandPalette.svelte\n- src/lib/utils/fuzzy-match.ts\n- src/lib/components/__tests__/CommandPalette.test.ts\n\n## References\n- INTEGRATION_PLAN D0.8: Power-User Ergonomics\n- Pattern: VS Code, Raycast command palettes","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:29:04.079958+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:04.079958+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.2","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:04.080641+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.3","title":"Implement Global Search (Cmd+/)","description":"# Global Search Implementation\n\n## Background\nGlobal Search (Cmd+/) searches across all data types: work items, convoys,\nmail, rigs. Different from Command Palette which is for actions.\n\n## UI Behavior\n- Trigger: Cmd+/ (Mac) / Ctrl+/ (Windows/Linux)\n- Search input with type filter dropdown\n- Results grouped by type\n- Click result to navigate\n\n## Search Types\n- Work items: title, description, ID\n- Convoys: title, item titles\n- Mail: subject, body, from/to\n- Rigs: name\n\n## Component Structure\n```svelte\n\u003c!-- src/lib/components/GlobalSearch.svelte --\u003e\n\n\u003cscript lang=\"ts\"\u003e\n  let open = $state(false);\n  let query = $state('');\n  let typeFilter = $state\u003c'all' | 'work' | 'convoy' | 'mail' | 'rig'\u003e('all');\n  \n  const results = $derived.by(async () =\u003e {\n    if (query.length \u003c 2) return [];\n    const response = await fetch(`/api/gastown/search?q=${query}\u0026type=${typeFilter}`);\n    return response.json();\n  });\n\u003c/script\u003e\n```\n\n## Acceptance Criteria\n- [ ] Opens with Cmd+/ / Ctrl+/\n- [ ] Search input with type filter\n- [ ] Results grouped by type\n- [ ] Keyboard navigation works\n- [ ] Debounced search requests\n- [ ] Loading state shown\n\n## Files\n- src/lib/components/GlobalSearch.svelte\n- src/routes/api/gastown/search/+server.ts\n\n## References\n- INTEGRATION_PLAN D0.8: Power-User Ergonomics","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:29:28.349347+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:28.349347+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.3","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:28.350035+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.4","title":"Implement Toast notification system","description":"# Toast Notification System Implementation\n\n## Background\nToasts provide non-blocking feedback for actions. They appear briefly at the\ntop-right (desktop) or bottom (mobile) and auto-dismiss.\n\n## Toast Types\n- **Success**: Green, checkmark icon\n- **Error**: Red, X icon, longer duration, \"Copy debug\" button\n- **Info**: Blue, info icon\n- **Warning**: Yellow, warning icon\n\n## Component API\n```typescript\n// Usage\ntoast.success('Work item created');\ntoast.error('Failed to load data', { requestId: 'abc-123' });\ntoast.info('Background refresh complete');\n\n// Toast store\ninterface Toast {\n  id: string;\n  type: 'success' | 'error' | 'info' | 'warning';\n  message: string;\n  duration?: number;  // ms, default varies by type\n  action?: { label: string; onclick: () =\u003e void };\n}\n```\n\n## Duration Defaults\n- Success: 3000ms\n- Info: 4000ms\n- Warning: 5000ms\n- Error: 8000ms (longer to read details)\n\n## Position\n- Desktop: Top-right\n- Mobile: Bottom (above any FAB)\n\n## Acceptance Criteria\n- [ ] Four toast types with distinct styling\n- [ ] Auto-dismiss after duration\n- [ ] Manual dismiss on click\n- [ ] Stack multiple toasts\n- [ ] Action button support\n- [ ] Mobile-friendly positioning\n- [ ] Reduced motion support (no slide-in)\n\n## Files\n- src/lib/components/Toast.svelte\n- src/lib/components/ToastContainer.svelte\n- src/lib/stores/toast.svelte.ts\n\n## References\n- INTEGRATION_PLAN: Toast System section","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":90,"created_at":"2026-01-12T22:29:28.651973+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:28.651973+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.4","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:28.65256+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.5","title":"Implement Error Boundary component","description":"# Error Boundary Implementation\n\n## Background\nError boundaries catch rendering errors and display a fallback UI instead of\ncrashing the entire page. Critical for production stability.\n\n## Features\n- Catches errors in child components\n- Displays user-friendly error message\n- Shows \"Copy debug info\" button\n- Offers \"Retry\" button\n- Logs to error tracking (future: Sentry)\n\n## Component API\n```svelte\n\u003cErrorBoundary fallback={ErrorFallback}\u003e\n  \u003cRiskyComponent /\u003e\n\u003c/ErrorBoundary\u003e\n```\n\n## Fallback UI\n```svelte\n\u003c!-- ErrorFallback.svelte --\u003e\n\u003cdiv class=\"error-boundary\"\u003e\n  \u003ch2\u003eSomething went wrong\u003c/h2\u003e\n  \u003cp\u003eWe couldn't load this section. Please try again.\u003c/p\u003e\n  \n  \u003cdiv class=\"actions\"\u003e\n    \u003cbutton onclick={retry}\u003eTry again\u003c/button\u003e\n    \u003cbutton onclick={copyDebugInfo}\u003eCopy debug info\u003c/button\u003e\n  \u003c/div\u003e\n  \n  \u003cdetails\u003e\n    \u003csummary\u003eTechnical details\u003c/summary\u003e\n    \u003cpre\u003e{error.message}\u003c/pre\u003e\n  \u003c/details\u003e\n\u003c/div\u003e\n```\n\n## Acceptance Criteria\n- [ ] Catches rendering errors\n- [ ] Shows fallback UI instead of white screen\n- [ ] Retry button resets component\n- [ ] Debug info copyable\n- [ ] Errors logged to console\n- [ ] Works with async components\n\n## Files\n- src/lib/components/ErrorBoundary.svelte\n- src/lib/components/ErrorFallback.svelte\n\n## References\n- INTEGRATION_PLAN: Error Handling section","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":60,"created_at":"2026-01-12T22:29:28.939447+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:28.939447+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.5","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:28.940044+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.6","title":"Implement Dashboard page with system overview","description":"# Dashboard Page Implementation\n\n## Background\nThe Dashboard is the landing page showing system overview: agent status,\nrecent activity, quick actions, and health indicators.\n\n## Layout\n```\n+--------------------------------------------------+\n| Header: Gas Town Dashboard                        |\n+--------------------------------------------------+\n| Agent Status Grid    | Recent Activity           |\n| +-------+ +-------+  | - Work item created       |\n| | Mayor | |Witness|  | - Merge completed         |\n| |  ✓    | |  ⏳   |  | - Mail received           |\n| +-------+ +-------+  +---------------------------+\n| Quick Actions        | Health Summary            |\n| [+ New Work]         | Workspace: ✓              |\n| [Run Doctor]         | Git: ⚠ uncommitted        |\n| [View Queue]         | Daemon: ✓                 |\n+--------------------------------------------------+\n```\n\n## Data Requirements\n- System status (agents, rigs)\n- Recent events from feed\n- Health check summary\n- Quick action buttons\n\n## Platform Variants (AGENTS.md)\n- **Mobile**: Single column, cards stacked\n- **Tablet**: Two columns\n- **Desktop**: Full layout with sidebar\n\n## Acceptance Criteria\n- [ ] Shows agent status with icons\n- [ ] Recent activity feed (last 10 events)\n- [ ] Health summary from diagnostics\n- [ ] Quick action buttons work\n- [ ] Loading skeletons (no spinners)\n- [ ] Responsive across platforms\n- [ ] Auto-refresh via SSE\n\n## Files\n- src/routes/+page.svelte (Dashboard)\n- src/routes/+page.server.ts\n\n## References\n- INTEGRATION_PLAN: CUJ-4 System Monitoring","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":180,"created_at":"2026-01-12T22:29:55.065823+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:55.065823+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.6","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:55.0666+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.7","title":"Implement Work Items page with filtering","description":"# Work Items Page Implementation\n\n## Background\nThe Work Items page shows all beads (tasks, bugs, epics, etc.) with filtering,\nsorting, and search capabilities.\n\n## Layout\n```\n+--------------------------------------------------+\n| Header: Work Items                    [+ New]     |\n+--------------------------------------------------+\n| Filters: [Type ▼] [Status ▼] [Priority ▼] [Search]|\n+--------------------------------------------------+\n| Work Item List                                    |\n| ┌─────────────────────────────────────────────┐  |\n| │ ● BD-123 Implement feature X         P1     │  |\n| │   task • open • @avyukth                    │  |\n| └─────────────────────────────────────────────┘  |\n| ┌─────────────────────────────────────────────┐  |\n| │ ● BD-124 Fix login bug               P0     │  |\n| │   bug • in_progress • @crew                 │  |\n| └─────────────────────────────────────────────┘  |\n+--------------------------------------------------+\n```\n\n## Features\n- Filter by type, status, priority, assignee\n- Sort by created, updated, priority\n- Search by title, description\n- Click to expand details\n- Bulk actions (select multiple)\n\n## Platform Variants (AGENTS.md)\n- **Mobile**: Card list, slide-out detail panel\n- **Tablet**: List with inline expansion\n- **Desktop**: Table view option, side panel for details\n\n## Acceptance Criteria\n- [ ] Filters work and persist in URL\n- [ ] Sorting works\n- [ ] Search debounced and responsive\n- [ ] Click expands work item details\n- [ ] Loading skeletons for list\n- [ ] Empty state when no results\n- [ ] Works on all platforms\n\n## Files\n- src/routes/work/+page.svelte\n- src/routes/work/+page.server.ts\n- src/lib/components/WorkItemCard.svelte\n- src/lib/components/WorkItemDetail.svelte\n\n## References\n- INTEGRATION_PLAN: CUJ-2 Work Item Lifecycle","status":"open","priority":1,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":240,"created_at":"2026-01-12T22:29:55.363591+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:55.363591+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.7","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:55.364299+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.8","title":"Implement Convoys page","description":"# Convoys Page Implementation\n\n## Background\nThe Convoys page shows batched work groups with progress visualization\nand the ability to drill down into contained items.\n\n## Features\n- Convoy list with progress bars\n- Expand to see contained items\n- Progress calculated from item statuses\n- Create new convoy (Phase 2)\n\n## Acceptance Criteria\n- [ ] Lists convoys with progress\n- [ ] Expandable to show items\n- [ ] Links to individual work items\n- [ ] Loading skeletons\n- [ ] Empty state\n\n## Files\n- src/routes/convoys/+page.svelte\n- src/lib/components/ConvoyCard.svelte\n\n## References\n- INTEGRATION_PLAN: Convoy views","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:29:55.639929+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:29:55.639929+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.8","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:29:55.640474+05:30","created_by":"Avyukth"}]}
{"id":"hq-wbe.9","title":"Implement Mail page","description":"# Mail Page Implementation\n\n## Background\nThe Mail page shows inbox/outbox for Gas Town mail system, enabling\ncommunication between agents and humans.\n\n## Features\n- Inbox view with unread indicators\n- Read/unread toggle\n- Message detail view\n- Compose new message (Phase 2)\n\n## Acceptance Criteria\n- [ ] Lists messages with unread badges\n- [ ] Click to view message\n- [ ] Mark as read works\n- [ ] Loading skeletons\n- [ ] Empty inbox state\n\n## Files\n- src/routes/mail/+page.svelte\n- src/lib/components/MailItem.svelte\n- src/lib/components/MailDetail.svelte\n\n## References\n- INTEGRATION_PLAN: CUJ-5 Mail View","status":"open","priority":2,"issue_type":"task","owner":"subhrajit.makur@hotmail.com","estimated_minutes":120,"created_at":"2026-01-12T22:30:08.725474+05:30","created_by":"Avyukth","updated_at":"2026-01-12T22:30:08.725474+05:30","labels":["layer:ui","phase:1"],"dependencies":[{"issue_id":"hq-wbe.9","depends_on_id":"hq-wbe","type":"parent-child","created_at":"2026-01-12T22:30:08.726206+05:30","created_by":"Avyukth"}]}
{"id":"hq-wisp-c9o","title":"Scan agent health","description":"Verify critical agents are running and responsive.\n\n**1. Check Mayor:**\n```bash\ngt mayor status\n```\n\nIf Mayor is down:\n```bash\ngt mayor start\n# If start fails after 3 attempts, escalate:\ngt mail send --human -s \"ESCALATION: Mayor won't start\" -m \"...\"\n```\n\n**2. Check Witnesses:**\n```bash\ngt witness list\n```\n\nFor each Witness that should be running:\n```bash\ngt witness status \u003crig\u003e\n```\n\nIf Witness is down:\n```bash\ngt witness start \u003crig\u003e\n# If start fails after 3 attempts, escalate\n```\n\n**3. Check Refineries (if applicable):**\n```bash\ngt refinery status\n```\n\n**4. Update heartbeat:**\n```bash\ngt deacon heartbeat \"patrol healthy\"\n```\n\n**5. Record scan results in state.json:**\n```json\n{\n  \"last_scan\": \"2025-12-23T13:30:00Z\",\n  \"mayor_status\": \"running\",\n  \"witnesses_checked\": [\"rig1\", \"rig2\"],\n  \"issues_found\": []\n}\n```\n\n**Exit criteria:** All agents checked, heartbeat updated, results recorded.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T20:56:03.491368+05:30","updated_at":"2026-01-12T20:56:03.491368+05:30","dependencies":[{"issue_id":"hq-wisp-c9o","depends_on_id":"hq-wisp-kl5","type":"parent-child","created_at":"2026-01-12T20:56:03.492491+05:30","created_by":"deacon"},{"issue_id":"hq-wisp-c9o","depends_on_id":"hq-wisp-jc6","type":"blocks","created_at":"2026-01-12T20:56:03.493534+05:30","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-jc6","title":"Check inbox for lifecycle requests","description":"Check for mail that needs immediate action.\n\n**1. Check inbox:**\n```bash\ngt mail inbox\n```\n\n**2. Process in priority order:**\n\n| Subject Pattern | Action |\n|-----------------|--------|\n| LIFECYCLE: * requesting cycle | Stop session, restart with handoff |\n| LIFECYCLE: * requesting restart | Stop session, fresh restart |\n| LIFECYCLE: * requesting shutdown | Stop session, don't restart |\n| TIMER: * wake at \u003ctime\u003e | If time passed, poke the agent |\n| ESCALATION: * | Log, attempt resolution, or forward |\n| HANDOFF: * | Read for context, then delete |\n\n**3. Process each message:**\n```bash\ngt mail read \u003cid\u003e           # Read the message\n# ... take appropriate action ...\ngt mail delete \u003cid\u003e         # ALWAYS delete after handling\n```\n\n**4. Handle lifecycle requests:**\n```bash\n# For Mayor cycle:\ngt mayor stop \u0026\u0026 gt mayor start\n\n# For Witness cycle:\ngt witness stop \u003crig\u003e \u0026\u0026 gt witness start \u003crig\u003e\n```\n\n**5. Handle timers:**\n```bash\n# Check if timer time has passed\n# If yes, poke the agent:\ngt mail send \u003cidentity\u003e -s \"WAKE\" -m \"Timer fired\"\n```\n\n**Exit criteria:** Inbox empty, all messages processed and deleted.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T20:56:03.491163+05:30","updated_at":"2026-01-12T20:56:03.491163+05:30","dependencies":[{"issue_id":"hq-wisp-jc6","depends_on_id":"hq-wisp-kl5","type":"parent-child","created_at":"2026-01-12T20:56:03.491871+05:30","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-wisp-kl5","title":"mol-deacon-patrol","description":"Deacon patrol cycle for Gas Town infrastructure monitoring.\n\nThis molecule guides the Deacon through a single patrol cycle. The Deacon runs\nthis as a wisp (ephemeral molecule), squashing it to a digest at the end.\n\n## Theory of Operation\n\nThe Deacon is the flywheel of Gas Town. Your continuous patrol keeps the\nwhole system spinning. Each patrol cycle:\n1. Checks inbox for lifecycle requests and timers\n2. Scans agent health (Mayor, Witnesses)\n3. Decides whether to loop or exit\n\n## Variables\n\n| Variable | Source | Description |\n|----------|--------|-------------|\n| patrol_count | state.json | Number of patrols this session |\n\n## Failure Modes\n\n| Situation | Action |\n|-----------|--------|\n| Agent down | Attempt restart, escalate after 3 failures |\n| Stuck lifecycle | Mail Witness for help |\n| High context | Hand off to fresh session |\n","status":"hooked","priority":2,"issue_type":"epic","assignee":"deacon/","created_at":"2026-01-12T20:56:03.490609+05:30","updated_at":"2026-01-12T20:56:36.696094+05:30","ephemeral":true}
{"id":"hq-wisp-vaz","title":"Decide to loop or exit","description":"Decide whether to continue patrolling or hand off.\n\n**1. Read state.json:**\n```bash\ncat state.json\n```\n\nCheck:\n- `patrol_count`: Number of patrols this session\n- `extraordinary_action`: Whether you did something major\n\n**2. Decision tree:**\n\n| Condition | Action |\n|-----------|--------|\n| `extraordinary_action == true` | Hand off immediately |\n| `patrol_count \u003e= 20` | Hand off (context hygiene) |\n| Otherwise | Loop (create new wisp) |\n\n**3. If handing off:**\n```bash\n# Update state\necho '{\"patrol_count\": 0, \"extraordinary_action\": false}' \u003e state.json\n\n# Squash current wisp\nbd mol squash \u003cwisp-id\u003e --summary=\"Patrol complete: N cycles, no major incidents\"\n\n# Hand off\ngt handoff -s \"Routine cycle\" -m \"Completed N patrols, no incidents\"\n```\n\n**4. If looping:**\n```bash\n# Increment patrol count in state.json\n# Update extraordinary_action = false if needed\n\n# Print cycle summary\necho \"Patrol cycle complete\"\n\n# Squash current wisp\nbd mol squash \u003cwisp-id\u003e --summary=\"Patrol cycle N complete\"\n\n# Create new patrol wisp\nbd mol wisp mol-deacon-patrol\nbd update \u003cnew-wisp-id\u003e --status=hooked --assignee=deacon\n\n# Continue immediately to inbox-check\n```\n\n**5. Sleep before next cycle (if looping):**\n```bash\n# Brief pause to avoid spinning too fast\nsleep 30\n```\n\n**Exit criteria:** Either handed off, or new patrol wisp created and started.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T20:56:03.491546+05:30","updated_at":"2026-01-12T20:56:03.491546+05:30","dependencies":[{"issue_id":"hq-wisp-vaz","depends_on_id":"hq-wisp-kl5","type":"parent-child","created_at":"2026-01-12T20:56:03.493027+05:30","created_by":"deacon"},{"issue_id":"hq-wisp-vaz","depends_on_id":"hq-wisp-c9o","type":"blocks","created_at":"2026-01-12T20:56:03.494028+05:30","created_by":"deacon"}],"ephemeral":true}
{"id":"hq-witness-role","title":"Witness Role","description":"Role definition for Witness agents. Per-rig worker monitor with progressive nudging.","status":"open","priority":2,"issue_type":"role","owner":"subhrajit.makur@hotmail.com","created_at":"2026-01-12T19:03:44.798845+05:30","created_by":"Avyukth","updated_at":"2026-01-12T19:03:44.798845+05:30","labels":["gt:role"]}
